{"version":3,"file":"inlineAssets.js","names":["inlineAssets","assets","resourcePath","resourceFilename","suffixPattern","mimeType","mimeTypes","lookup","undefined","size","getImageSize","Error","sourceSet","map","asset","encodeAsset","JSON","stringify","length","encodedContent","content","Buffer","toString","from","uri","width","height","scale"],"sources":["../../../../src/webpack/loaders/assetsLoader/inlineAssets.ts"],"sourcesContent":["import mimeTypes from 'mime-types';\nimport type { Asset, ImageSize, URISource } from './types';\nimport { getImageSize } from './utils';\n\nexport function inlineAssets({\n  assets,\n  resourcePath,\n  resourceFilename,\n  suffixPattern,\n}: {\n  assets: Asset[];\n  resourcePath: string;\n  resourceFilename: string;\n  suffixPattern: string;\n}) {\n  const mimeType = mimeTypes.lookup(resourcePath) || undefined;\n  const size = getImageSize({ resourcePath, resourceFilename, suffixPattern });\n\n  if (!mimeType) {\n    throw new Error(\n      `Cannot inline asset for request ${resourcePath} - unable to detect mime type`\n    );\n  }\n\n  const sourceSet = assets.map((asset) => encodeAsset(asset, mimeType, size));\n\n  return `module.exports = ${JSON.stringify(\n    sourceSet.length === 1 ? sourceSet[0] : sourceSet\n  )}`;\n}\n\nfunction encodeAsset(\n  asset: Asset,\n  mimeType: string,\n  size?: ImageSize\n): URISource {\n  const encodedContent =\n    asset.content instanceof Buffer\n      ? asset.content.toString('base64')\n      : Buffer.from(asset.content ?? '').toString('base64');\n\n  return {\n    uri: `data:${mimeType};base64,${encodedContent}`,\n    width: size?.width,\n    height: size?.height,\n    scale: asset.scale,\n  };\n}\n"],"mappings":";;;;;;;AAAA;;AAEA;;;;AAEO,SAASA,YAAT,CAAsB;EAC3BC,MAD2B;EAE3BC,YAF2B;EAG3BC,gBAH2B;EAI3BC;AAJ2B,CAAtB,EAUJ;EACD,MAAMC,QAAQ,GAAGC,kBAAA,CAAUC,MAAV,CAAiBL,YAAjB,KAAkCM,SAAnD;EACA,MAAMC,IAAI,GAAG,IAAAC,mBAAA,EAAa;IAAER,YAAF;IAAgBC,gBAAhB;IAAkCC;EAAlC,CAAb,CAAb;;EAEA,IAAI,CAACC,QAAL,EAAe;IACb,MAAM,IAAIM,KAAJ,CACH,mCAAkCT,YAAa,+BAD5C,CAAN;EAGD;;EAED,MAAMU,SAAS,GAAGX,MAAM,CAACY,GAAP,CAAYC,KAAD,IAAWC,WAAW,CAACD,KAAD,EAAQT,QAAR,EAAkBI,IAAlB,CAAjC,CAAlB;EAEA,OAAQ,oBAAmBO,IAAI,CAACC,SAAL,CACzBL,SAAS,CAACM,MAAV,KAAqB,CAArB,GAAyBN,SAAS,CAAC,CAAD,CAAlC,GAAwCA,SADf,CAEzB,EAFF;AAGD;;AAED,SAASG,WAAT,CACED,KADF,EAEET,QAFF,EAGEI,IAHF,EAIa;EACX,MAAMU,cAAc,GAClBL,KAAK,CAACM,OAAN,YAAyBC,MAAzB,GACIP,KAAK,CAACM,OAAN,CAAcE,QAAd,CAAuB,QAAvB,CADJ,GAEID,MAAM,CAACE,IAAP,CAAYT,KAAK,CAACM,OAAN,IAAiB,EAA7B,EAAiCE,QAAjC,CAA0C,QAA1C,CAHN;EAKA,OAAO;IACLE,GAAG,EAAG,QAAOnB,QAAS,WAAUc,cAAe,EAD1C;IAELM,KAAK,EAAEhB,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEgB,KAFR;IAGLC,MAAM,EAAEjB,IAAF,aAAEA,IAAF,uBAAEA,IAAI,CAAEiB,MAHT;IAILC,KAAK,EAAEb,KAAK,CAACa;EAJR,CAAP;AAMD"}