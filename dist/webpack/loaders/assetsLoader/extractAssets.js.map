{"version":3,"file":"extractAssets.js","names":["_path","_interopRequireDefault","require","_dedent","_hasha","_utils","obj","__esModule","default","extractAssets","resourcePath","resourceDirname","resourceFilename","resourceExtensionType","assets","suffixPattern","assetsDirname","pathSeparatorRegexp","publicPath","customPublicPath","devServerEnabled","logger","path","join","replace","hashes","Promise","all","map","asset","hasha","async","content","toString","filename","algorithm","size","getImageSize","debug","height","width","dedent","JSON","stringify","scale"],"sources":["../../../../src/webpack/loaders/assetsLoader/extractAssets.ts"],"sourcesContent":["import path from 'path';\nimport dedent from 'dedent';\nimport hasha from 'hasha';\nimport type { WebpackLogger } from '../../../types';\nimport type { Asset } from './types';\nimport { getImageSize } from './utils';\n\nexport async function extractAssets(\n  {\n    resourcePath,\n    resourceDirname,\n    resourceFilename,\n    resourceExtensionType,\n    assets,\n    suffixPattern,\n    assetsDirname,\n    pathSeparatorRegexp,\n    publicPath: customPublicPath,\n    devServerEnabled,\n  }: {\n    resourcePath: string;\n    resourceDirname: string;\n    resourceFilename: string;\n    resourceExtensionType: string;\n    assets: Asset[];\n    suffixPattern: string;\n    assetsDirname: string;\n    pathSeparatorRegexp: RegExp;\n    publicPath?: string;\n    devServerEnabled?: boolean;\n  },\n  logger: WebpackLogger\n) {\n  let publicPath = path\n    .join(assetsDirname, resourceDirname)\n    .replace(pathSeparatorRegexp, '/');\n\n  if (customPublicPath) {\n    publicPath = path.join(customPublicPath, publicPath);\n  }\n\n  const hashes = await Promise.all(\n    assets.map((asset) =>\n      hasha.async(asset.content?.toString() ?? asset.filename, {\n        algorithm: 'md5',\n      })\n    )\n  );\n\n  const size = getImageSize({\n    resourceFilename,\n    resourcePath,\n    suffixPattern,\n  });\n\n  logger.debug(`Extracted assets for request ${resourcePath}`, {\n    hashes,\n    publicPath: customPublicPath,\n    height: size?.height,\n    width: size?.width,\n  });\n\n  return dedent`\n    var AssetRegistry = require('react-native/Libraries/Image/AssetRegistry');\n    module.exports = AssetRegistry.registerAsset({\n      __packager_asset: true,\n      scales: ${JSON.stringify(assets.map((asset) => asset.scale))},\n      name: ${JSON.stringify(resourceFilename)},\n      type: ${JSON.stringify(resourceExtensionType)},\n      hash: ${JSON.stringify(hashes.join())},\n      httpServerLocation: ${JSON.stringify(publicPath)},\n      ${\n        devServerEnabled\n          ? `fileSystemLocation: ${JSON.stringify(resourceDirname)},`\n          : ''\n      }\n      ${size ? `height: ${size.height},` : ''}\n      ${size ? `width: ${size.width},` : ''}\n    });\n    `;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,KAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,OAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,MAAA,GAAAH,sBAAA,CAAAC,OAAA;AAGA,IAAAG,MAAA,GAAAH,OAAA;AAAuC,SAAAD,uBAAAK,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAEhC,eAAeG,aAAaA,CACjC;EACEC,YAAY;EACZC,eAAe;EACfC,gBAAgB;EAChBC,qBAAqB;EACrBC,MAAM;EACNC,aAAa;EACbC,aAAa;EACbC,mBAAmB;EACnBC,UAAU,EAAEC,gBAAgB;EAC5BC;AAYF,CAAC,EACDC,MAAqB,EACrB;EACA,IAAIH,UAAU,GAAGI,aAAI,CAClBC,IAAI,CAACP,aAAa,EAAEL,eAAe,CAAC,CACpCa,OAAO,CAACP,mBAAmB,EAAE,GAAG,CAAC;EAEpC,IAAIE,gBAAgB,EAAE;IACpBD,UAAU,GAAGI,aAAI,CAACC,IAAI,CAACJ,gBAAgB,EAAED,UAAU,CAAC;EACtD;EAEA,MAAMO,MAAM,GAAG,MAAMC,OAAO,CAACC,GAAG,CAC9Bb,MAAM,CAACc,GAAG,CAAEC,KAAK,IACfC,cAAK,CAACC,KAAK,CAACF,KAAK,CAACG,OAAO,EAAEC,QAAQ,CAAC,CAAC,IAAIJ,KAAK,CAACK,QAAQ,EAAE;IACvDC,SAAS,EAAE;EACb,CAAC,CACH,CACF,CAAC;EAED,MAAMC,IAAI,GAAG,IAAAC,mBAAY,EAAC;IACxBzB,gBAAgB;IAChBF,YAAY;IACZK;EACF,CAAC,CAAC;EAEFM,MAAM,CAACiB,KAAK,CAAE,gCAA+B5B,YAAa,EAAC,EAAE;IAC3De,MAAM;IACNP,UAAU,EAAEC,gBAAgB;IAC5BoB,MAAM,EAAEH,IAAI,EAAEG,MAAM;IACpBC,KAAK,EAAEJ,IAAI,EAAEI;EACf,CAAC,CAAC;EAEF,OAAO,IAAAC,eAAM,CAAC;AAChB;AACA;AACA;AACA,gBAAgBC,IAAI,CAACC,SAAS,CAAC7B,MAAM,CAACc,GAAG,CAAEC,KAAK,IAAKA,KAAK,CAACe,KAAK,CAAC,CAAE;AACnE,cAAcF,IAAI,CAACC,SAAS,CAAC/B,gBAAgB,CAAE;AAC/C,cAAc8B,IAAI,CAACC,SAAS,CAAC9B,qBAAqB,CAAE;AACpD,cAAc6B,IAAI,CAACC,SAAS,CAAClB,MAAM,CAACF,IAAI,CAAC,CAAC,CAAE;AAC5C,4BAA4BmB,IAAI,CAACC,SAAS,CAACzB,UAAU,CAAE;AACvD,QACQE,gBAAgB,GACX,uBAAsBsB,IAAI,CAACC,SAAS,CAAChC,eAAe,CAAE,GAAE,GACzD,EACL;AACP,QAAQyB,IAAI,GAAI,WAAUA,IAAI,CAACG,MAAO,GAAE,GAAG,EAAG;AAC9C,QAAQH,IAAI,GAAI,UAASA,IAAI,CAACI,KAAM,GAAE,GAAG,EAAG;AAC5C;AACA,KAAK;AACL","ignoreList":[]}