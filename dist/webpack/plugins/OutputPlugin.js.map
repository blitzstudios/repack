{"version":3,"file":"OutputPlugin.js","names":["_path","_interopRequireDefault","require","_webpack","_AssetsCopyProcessor","_AuxiliaryAssetsCopyProcessor","obj","__esModule","default","OutputPlugin","constructor","config","enabled","platform","Error","output","extraChunks","include","type","outputPath","path","join","context","apply","compiler","options","logger","getInfrastructureLogger","extraAssets","map","spec","isAbsolute","isLocalChunk","chunkId","webpack","ModuleFilenameHelpers","matchObject","test","exclude","getRelatedSourceMap","chunk","auxiliaryFiles","find","file","getAllInitialChunks","chunks","parents","length","flatMap","parent","get","hooks","done","tapPromise","stats","compilationStats","toJson","all","assets","chunkRelations","ids","statsChunkMap","Map","id","entryChunkName","entryName","localChunks","remoteChunks","sharedChunks","Set","auxiliaryAssets","entryChunk","initial","names","includes","has","filter","sharedChunk","forEach","add","push","name","toString","isUsedByLocalChunk","some","localChunk","asset","localAssetsCopyProcessor","bundleFilename","sourceMapFilename","assetsPath","bundlePath","dirname","debug","AssetsCopyProcessor","bundleOutput","bundleOutputDir","sourcemapOutput","assetsDest","remoteAssetsCopyProcessors","enqueueChunk","isEntry","sourceMapFile","auxiliaryAssetsCopyProcessor","auxiliaryAssetsPath","AuxiliaryAssetsCopyProcessor","enqueueAsset","Promise","execute","Object","values","reduce","acc","processor","concat","exports"],"sources":["../../../src/webpack/plugins/OutputPlugin.ts"],"sourcesContent":["import path from 'path';\nimport webpack from 'webpack';\nimport { Rule, WebpackPlugin } from '../../types';\nimport { AssetsCopyProcessor } from './utils/AssetsCopyProcessor';\nimport { AuxiliaryAssetsCopyProcessor } from './utils/AuxiliaryAssetsCopyProcessor';\n\n/**\n * Matching options to check if given {@link DestinationConfig} should be used.\n */\nexport type DestinationMatchRules = {\n  /**\n   * Rule (string or RegExp) that must match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  test?: Rule | Rule[];\n\n  /**\n   * Rule (string or RegExp) that must match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  include?: Rule | Rule[];\n\n  /**\n   * Rule (string or RegExp) that __MUST NOT__ match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  exclude?: Rule | Rule[];\n};\n\n/**\n * Destination config for local chunks.\n */\nexport type LocalDestinationConfig = {\n  type: 'local';\n};\n\n/**\n * Destination config for remote chunks.\n */\nexport type RemoteDestinationConfig = {\n  type: 'remote';\n\n  /** Output path to a directory, where remote chunks should be saved. */\n  outputPath: string;\n};\n\n/**\n * Destination config for chunks.\n */\nexport type DestinationConfig =\n  | LocalDestinationConfig\n  | RemoteDestinationConfig;\n\n/**\n * Destination specification for chunks.\n */\nexport type DestinationSpec = DestinationMatchRules & DestinationConfig;\n\n/**\n * {@link OutputPlugin} configuration options.\n */\nexport interface OutputPluginConfig {\n  /** Context in which all resolution happens. Usually it's project root directory. */\n  context: string;\n\n  /** Target application platform. */\n  platform: string;\n\n  /**\n   * Whether the plugin is enabled. Defaults to `true`.\n   *\n   * Useful when running with development server, in which case, it's not necessary for this plugin\n   * to be enabled.\n   */\n  enabled?: boolean;\n\n  /** The entry chunk name, `main` by default. */\n  entryName?: string;\n\n  /**\n   * Output options specifying where to save generated bundle, source map and assets.\n   */\n  output: {\n    /** Bundle output filename - name under which generated bundle will be saved. */\n    bundleFilename?: string;\n\n    /**\n     * Source map filename - name under which generated source map (for the main bundle) will be saved.\n     */\n    sourceMapFilename?: string;\n\n    /** Assets output path - directory where generated static assets will be saved. */\n    assetsPath?: string;\n\n    /**\n     * Auxiliary assets output path - directory where generated auxiliary assets will be saved\n     *\n     * Useful when working with remote-assets generated by assetsLoader\n     * */\n    auxiliaryAssetsPath?: string;\n  };\n\n  /**\n   * Options specifying how to deal with extra chunks generated in the compilation,\n   * usually by using dynamic `import(...)` function.\n   *\n   * By default all extra chunks will be saved under `<projectRoot>/build/outputs/<platform>/remotes` directory.\n   *\n   * __Specifying custom value for this option, will disable default setting - you will need\n   * to configure `outputPath` for `type: 'remote'` yourself.__\n   *\n   * If you want to have some of the chunks available inside the `.ipa`/`.apk` file generated by React Native,\n   * you must configure this options to match the chunks you want (using `test`/`include`/`exclude`)\n   * and set the `type` to `local`, for example:\n   * ```ts\n   * new OutputPlugin({\n   *   context,\n   *   platform,\n   *   output,\n   *   extraChunks: [\n   *     {\n   *       // Make `my-chunk` local\n   *       include: /my-chunk/,\n   *       type: 'local',\n   *     },\n   *     {\n   *       // Make any other chunk remote\n   *       exclude: /my-chunk/,\n   *       type: 'remote',\n   *       outputPath,\n   *     },\n   *   ]\n   * });\n   * ```\n   */\n  extraChunks?: DestinationSpec[];\n}\n\n/**\n * Plugin for copying generated files (bundle, chunks, assets) from Webpack's built location to the\n * React Native application directory, so that the files can be packed together into the `ipa`/`apk`.\n *\n * @category Webpack Plugin\n */\nexport class OutputPlugin implements WebpackPlugin {\n  /**\n   * Constructs new `OutputPlugin`.\n   *\n   * @param config Plugin configuration options.\n   */\n  constructor(private config: OutputPluginConfig) {\n    this.config.enabled = this.config.enabled ?? true;\n\n    if (!this.config.platform) {\n      throw new Error('Missing `platform` option in `OutputPlugin`');\n    }\n\n    if (!this.config.output) {\n      throw new Error('Missing `output` option in `OutputPlugin`');\n    }\n\n    this.config.extraChunks = this.config.extraChunks ?? [\n      {\n        include: /.*/,\n        type: 'remote',\n        outputPath: path.join(\n          this.config.context,\n          'build/outputs',\n          this.config.platform,\n          'remotes'\n        ),\n      },\n    ];\n  }\n\n  /**\n   * Apply the plugin.\n   *\n   * @param compiler Webpack compiler instance.\n   */\n  apply(compiler: webpack.Compiler) {\n    if (!this.config.enabled) {\n      return;\n    }\n\n    const outputPath = compiler.options.output?.path;\n    if (!outputPath) {\n      throw new Error('Cannot infer output path from compilation');\n    }\n\n    const logger = compiler.getInfrastructureLogger('RepackOutputPlugin');\n\n    const extraAssets = (this.config.extraChunks ?? []).map((spec) =>\n      spec.type === 'remote'\n        ? {\n            ...spec,\n            outputPath: !path.isAbsolute(spec.outputPath)\n              ? path.join(this.config.context, spec.outputPath)\n              : spec.outputPath,\n          }\n        : spec\n    );\n\n    const isLocalChunk = (chunkId: string | undefined): boolean => {\n      for (const spec of extraAssets) {\n        if (spec.type === 'local') {\n          if (\n            webpack.ModuleFilenameHelpers.matchObject(\n              {\n                test: spec.test,\n                include: spec.include,\n                exclude: spec.exclude,\n              },\n              chunkId || ''\n            )\n          ) {\n            return true;\n          }\n        }\n      }\n      return false;\n    };\n\n    const getRelatedSourceMap = (chunk: webpack.StatsChunk) => {\n      return chunk.auxiliaryFiles?.find((file) => /\\.map$/.test(file));\n    };\n\n    const getAllInitialChunks = (\n      chunk: webpack.StatsChunk,\n      chunks: Map<string | number, webpack.StatsChunk>\n    ): Array<webpack.StatsChunk> => {\n      if (!chunk.parents?.length) return [chunk];\n      return chunk.parents.flatMap((parent) => {\n        return getAllInitialChunks(chunks.get(parent)!, chunks);\n      });\n    };\n\n    compiler.hooks.done.tapPromise('RepackOutputPlugin', async (stats) => {\n      const compilationStats = stats.toJson({\n        all: false,\n        assets: true,\n        chunks: true,\n        chunkRelations: true,\n        ids: true,\n      });\n      const statsChunkMap = new Map(\n        compilationStats.chunks!.map((chunk) => [chunk.id!, chunk])\n      );\n      const entryChunkName = this.config.entryName ?? 'main';\n      const localChunks: webpack.StatsChunk[] = [];\n      const remoteChunks: webpack.StatsChunk[] = [];\n      const sharedChunks = new Set<webpack.StatsChunk>();\n      const auxiliaryAssets: Set<string> = new Set();\n\n      const entryChunk = compilationStats.chunks!.find((chunk) => {\n        return chunk.initial && chunk.names?.includes(entryChunkName);\n      });\n\n      for (const chunk of compilationStats.chunks!) {\n        // Do not process shared chunks right now.\n        if (sharedChunks.has(chunk)) {\n          continue;\n        }\n\n        getAllInitialChunks(chunk, statsChunkMap)\n          .filter((sharedChunk) => sharedChunk !== chunk)\n          .forEach((sharedChunk) => {\n            sharedChunks.add(sharedChunk);\n          });\n\n        // Entry chunk\n        if (entryChunk === chunk) {\n          localChunks.push(chunk);\n        } else if (isLocalChunk(chunk.name ?? chunk.id?.toString())) {\n          localChunks.push(chunk);\n        } else {\n          remoteChunks.push(chunk);\n        }\n      }\n\n      // Process shared chunks to add them either as local or remote chunk.\n      for (const sharedChunk of sharedChunks) {\n        const isUsedByLocalChunk = localChunks.some((localChunk) =>\n          getAllInitialChunks(localChunk, statsChunkMap).includes(sharedChunk)\n        );\n        if (\n          isUsedByLocalChunk ||\n          isLocalChunk(sharedChunk.name ?? sharedChunk.id?.toString())\n        ) {\n          localChunks.push(sharedChunk);\n        } else {\n          remoteChunks.push(sharedChunk);\n        }\n      }\n\n      const assets = compilationStats.assets!;\n      // Collect auxiliary assets (only remote-assets for now)\n      assets\n        .filter((asset) => /^remote-assets/.test(asset.name))\n        .forEach((asset) => auxiliaryAssets.add(asset.name));\n\n      let localAssetsCopyProcessor;\n\n      let { bundleFilename, sourceMapFilename, assetsPath } =\n        this.config.output;\n\n      if (bundleFilename) {\n        if (!path.isAbsolute(bundleFilename)) {\n          bundleFilename = path.join(this.config.context, bundleFilename);\n        }\n\n        const bundlePath = path.dirname(bundleFilename);\n\n        if (!sourceMapFilename) {\n          sourceMapFilename = `${bundleFilename}.map`;\n        }\n\n        if (!path.isAbsolute(sourceMapFilename)) {\n          sourceMapFilename = path.join(this.config.context, sourceMapFilename);\n        }\n\n        if (!assetsPath) {\n          assetsPath = bundlePath;\n        }\n\n        logger.debug('Detected output paths:', {\n          bundleFilename,\n          bundlePath,\n          sourceMapFilename,\n          assetsPath,\n        });\n\n        localAssetsCopyProcessor = new AssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          bundleOutput: bundleFilename,\n          bundleOutputDir: bundlePath,\n          sourcemapOutput: sourceMapFilename,\n          assetsDest: assetsPath,\n          logger,\n        });\n      }\n\n      const remoteAssetsCopyProcessors: Record<string, AssetsCopyProcessor> =\n        {};\n\n      for (const chunk of localChunks) {\n        // Process entry chunk\n        localAssetsCopyProcessor?.enqueueChunk(chunk, {\n          isEntry: entryChunk === chunk,\n          sourceMapFile: getRelatedSourceMap(chunk),\n        });\n      }\n\n      for (const chunk of remoteChunks) {\n        const spec = extraAssets.find((spec) =>\n          webpack.ModuleFilenameHelpers.matchObject(\n            {\n              test: spec.test,\n              include: spec.include,\n              exclude: spec.exclude,\n            },\n            chunk.name || chunk.id?.toString()\n          )\n        );\n\n        if (spec?.type === 'remote') {\n          if (!remoteAssetsCopyProcessors[spec.outputPath]) {\n            remoteAssetsCopyProcessors[spec.outputPath] =\n              new AssetsCopyProcessor({\n                platform: this.config.platform,\n                outputPath,\n                bundleOutput: '',\n                bundleOutputDir: spec.outputPath,\n                sourcemapOutput: '',\n                assetsDest: spec.outputPath,\n                logger,\n              });\n          }\n\n          remoteAssetsCopyProcessors[spec.outputPath].enqueueChunk(chunk, {\n            isEntry: false,\n            sourceMapFile: getRelatedSourceMap(chunk),\n          });\n        }\n      }\n\n      let auxiliaryAssetsCopyProcessor;\n      const { auxiliaryAssetsPath } = this.config.output;\n      if (auxiliaryAssetsPath) {\n        auxiliaryAssetsCopyProcessor = new AuxiliaryAssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          assetsDest: auxiliaryAssetsPath,\n          logger,\n        });\n\n        for (const asset of auxiliaryAssets) {\n          auxiliaryAssetsCopyProcessor.enqueueAsset(asset);\n        }\n      }\n\n      await Promise.all([\n        ...(localAssetsCopyProcessor?.execute() ?? []),\n        ...Object.values(remoteAssetsCopyProcessors).reduce(\n          (acc, processor) => acc.concat(...processor.execute()),\n          [] as Promise<void>[]\n        ),\n        ...(auxiliaryAssetsCopyProcessor?.execute() ?? []),\n      ]);\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}