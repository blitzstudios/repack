{"version":3,"file":"OutputPlugin.js","names":["_nodePath","_interopRequireDefault","require","_nodeAssert","_webpack","_AssetsCopyProcessor","_AuxiliaryAssetsCopyProcessor","obj","__esModule","default","OutputPlugin","constructor","config","enabled","extraChunks","include","type","outputPath","path","join","context","platform","matchChunkToSpecs","chunk","specs","chunkIds","names","id","flat","filter","spec","test","exclude","some","webpack","ModuleFilenameHelpers","matchObject","toString","getRelatedSourceMap","auxiliaryFiles","find","file","ensureAbsolutePath","filePath","isAbsolute","apply","compiler","assert","output","options","logger","getInfrastructureLogger","nativeEntryChunkName","entryName","localSpecs","remoteSpecs","forEach","push","localChunks","Set","remoteChunks","auxiliaryAssets","hooks","done","tapPromise","stats","compilationStats","toJson","all","assets","chunks","chunkRelations","ids","chunksById","Map","map","initial","entry","add","has","flatMap","siblings","chunkId","get","length","addParentsOfLocalChunks","parents","size","asset","name","localAssetsCopyProcessor","bundleFilename","sourceMapFilename","assetsPath","bundlePath","dirname","debug","AssetsCopyProcessor","bundleOutput","bundleOutputDir","sourcemapOutput","assetsDest","remoteAssetsCopyProcessors","enqueueChunk","isEntry","sourceMapFile","Error","warn","specOutputPath","auxiliaryAssetsCopyProcessor","auxiliaryAssetsPath","AuxiliaryAssetsCopyProcessor","enqueueAsset","Promise","execute","Object","values","reduce","acc","processor","concat","exports"],"sources":["../../../src/webpack/plugins/OutputPlugin.ts"],"sourcesContent":["import path from 'node:path';\nimport assert from 'node:assert';\nimport webpack from 'webpack';\nimport { Rule, WebpackPlugin } from '../../types';\nimport { AssetsCopyProcessor } from './utils/AssetsCopyProcessor';\nimport { AuxiliaryAssetsCopyProcessor } from './utils/AuxiliaryAssetsCopyProcessor';\n\n/**\n * Matching options to check if given {@link DestinationConfig} should be used.\n */\nexport type DestinationMatchRules = {\n  /**\n   * Rule (string or RegExp) that must match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  test?: Rule | Rule[];\n\n  /**\n   * Rule (string or RegExp) that must match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  include?: Rule | Rule[];\n\n  /**\n   * Rule (string or RegExp) that __MUST NOT__ match the chunk name (or id if name is not available),\n   * for the whole `DestinationMatchRules` to match.\n   */\n  exclude?: Rule | Rule[];\n};\n\n/**\n * Destination config for local chunks.\n */\nexport type LocalDestinationConfig = {\n  type: 'local';\n};\n\n/**\n * Destination config for remote chunks.\n */\nexport type RemoteDestinationConfig = {\n  type: 'remote';\n\n  /** Output path to a directory, where remote chunks should be saved. */\n  outputPath: string;\n};\n\n/**\n * Destination config for chunks.\n */\nexport type DestinationConfig =\n  | LocalDestinationConfig\n  | RemoteDestinationConfig;\n\n/**\n * Destination specification for chunks.\n */\nexport type DestinationSpec = DestinationMatchRules & DestinationConfig;\n\n/**\n * {@link OutputPlugin} configuration options.\n */\nexport interface OutputPluginConfig {\n  /** Context in which all resolution happens. Usually it's project root directory. */\n  context: string;\n\n  /** Target application platform. */\n  platform: string;\n\n  /**\n   * Whether the plugin is enabled. Defaults to `true`.\n   *\n   * Useful when running with development server, in which case, it's not necessary for this plugin\n   * to be enabled.\n   */\n  enabled?: boolean;\n\n  /** The entry chunk name, `main` by default. */\n  entryName?: string;\n\n  /**\n   * Output options specifying where to save generated bundle, source map and assets.\n   */\n  output: {\n    /** Bundle output filename - name under which generated bundle will be saved. */\n    bundleFilename?: string;\n\n    /**\n     * Source map filename - name under which generated source map (for the main bundle) will be saved.\n     */\n    sourceMapFilename?: string;\n\n    /** Assets output path - directory where generated static assets will be saved. */\n    assetsPath?: string;\n\n    /**\n     * Auxiliary assets output path - directory where generated auxiliary assets will be saved\n     *\n     * Useful when working with remote-assets generated by assetsLoader\n     * */\n    auxiliaryAssetsPath?: string;\n  };\n\n  /**\n   * Options specifying how to deal with extra chunks generated in the compilation,\n   * usually by using dynamic `import(...)` function.\n   *\n   * By default all extra chunks will be saved under `<projectRoot>/build/outputs/<platform>/remotes` directory.\n   *\n   * __Specifying custom value for this option, will disable default setting - you will need\n   * to configure `outputPath` for `type: 'remote'` yourself.__\n   *\n   * If you want to have some of the chunks available inside the `.ipa`/`.apk` file generated by React Native,\n   * you must configure this options to match the chunks you want (using `test`/`include`/`exclude`)\n   * and set the `type` to `local`, for example:\n   * ```ts\n   * new OutputPlugin({\n   *   context,\n   *   platform,\n   *   output,\n   *   extraChunks: [\n   *     {\n   *       // Make `my-chunk` local\n   *       include: /my-chunk/,\n   *       type: 'local',\n   *     },\n   *     {\n   *       // Make any other chunk remote\n   *       exclude: /my-chunk/,\n   *       type: 'remote',\n   *       outputPath,\n   *     },\n   *   ]\n   * });\n   * ```\n   */\n  extraChunks?: DestinationSpec[];\n}\n\n/**\n * Plugin for copying generated files (bundle, chunks, assets) from Webpack's built location to the\n * React Native application directory, so that the files can be packed together into the `ipa`/`apk`.\n *\n * @category Webpack Plugin\n */\nexport class OutputPlugin implements WebpackPlugin {\n  /**\n   * Constructs new `OutputPlugin`.\n   *\n   * @param config Plugin configuration options.\n   */\n  constructor(private config: OutputPluginConfig) {\n    this.config.enabled = this.config.enabled ?? true;\n    this.config.extraChunks = this.config.extraChunks ?? [\n      {\n        include: /.*/,\n        type: 'remote',\n        outputPath: path.join(\n          this.config.context,\n          'build/outputs',\n          this.config.platform,\n          'remotes'\n        ),\n      },\n    ];\n  }\n\n  private matchChunkToSpecs(\n    chunk: webpack.StatsChunk,\n    specs: DestinationSpec[]\n  ) {\n    const chunkIds = [chunk.names ?? [], chunk.id!].flat();\n    return specs.filter((spec) => {\n      const { test, include, exclude } = spec;\n      const config = { test, include, exclude };\n      return chunkIds.some((id) =>\n        webpack.ModuleFilenameHelpers.matchObject(config, id.toString())\n      );\n    });\n  }\n\n  private getRelatedSourceMap(chunk: webpack.StatsChunk) {\n    return chunk.auxiliaryFiles?.find((file) => /\\.map$/.test(file));\n  }\n\n  private ensureAbsolutePath(filePath: string) {\n    if (path.isAbsolute(filePath)) return filePath;\n    return path.join(this.config.context, filePath);\n  }\n  /**\n   * Apply the plugin.\n   *\n   * @param compiler Webpack compiler instance.\n   */\n  apply(compiler: webpack.Compiler) {\n    if (!this.config.enabled) return;\n\n    assert(this.config.platform, 'Missing `platform` option in `OutputPlugin`');\n    assert(this.config.output, 'Missing `output` option in `OutputPlugin`');\n    assert(compiler.options.output.path, \"Can't infer output path from config\");\n\n    const logger = compiler.getInfrastructureLogger('RepackOutputPlugin');\n    const outputPath = compiler.options.output.path as string;\n    const nativeEntryChunkName = this.config.entryName ?? 'main';\n\n    // Split specs into types\n    const localSpecs: DestinationSpec[] = [];\n    const remoteSpecs: DestinationSpec[] = [];\n\n    this.config.extraChunks?.forEach((spec) => {\n      if (spec.type === 'local') localSpecs.push(spec);\n      if (spec.type === 'remote') remoteSpecs.push(spec);\n    });\n\n    const localChunks = new Set<webpack.StatsChunk>();\n    const remoteChunks = new Set<webpack.StatsChunk>();\n    const auxiliaryAssets = new Set<string>();\n\n    compiler.hooks.done.tapPromise('RepackOutputPlugin', async (stats) => {\n      const compilationStats = stats.toJson({\n        all: false,\n        assets: true,\n        chunks: true,\n        chunkRelations: true,\n        ids: true,\n      });\n\n      const chunks = compilationStats.chunks!;\n      const assets = compilationStats.assets!;\n\n      const chunksById = new Map(chunks.map((chunk) => [chunk.id!, chunk]));\n\n      // Add explicitly known initial chunks as local chunks\n      chunks\n        .filter((chunk) => chunk.initial && chunk.entry)\n        .filter((chunk) => chunk.id! in compiler.options.entry)\n        .forEach((chunk) => localChunks.add(chunk));\n\n      // Add siblings of known initial chunks as local chunks\n      chunks\n        .filter((chunk) => localChunks.has(chunk))\n        .flatMap((chunk) => chunk.siblings!)\n        .map((chunkId) => chunksById.get(chunkId))\n        .forEach((chunk) => localChunks.add(chunk!));\n\n      // Add chunks matching local specs as local chunks\n      chunks\n        .filter((chunk) => this.matchChunkToSpecs(chunk, localSpecs).length)\n        .forEach((chunk) => localChunks.add(chunk));\n\n      // Add parents of local chunks as local chunks\n      const addParentsOfLocalChunks = () => {\n        chunks\n          .filter((chunk) => localChunks.has(chunk))\n          .flatMap((chunk) => chunk.parents!)\n          .map((chunkId) => chunksById.get(chunkId))\n          .forEach((chunk) => localChunks.add(chunk!));\n        return localChunks.size;\n      };\n\n      // Iterate until no new chunks are added\n      while (localChunks.size - addParentsOfLocalChunks());\n\n      // Add all other chunks as remote chunks\n      chunks\n        .filter((chunk) => !localChunks.has(chunk))\n        .forEach((chunk) => remoteChunks.add(chunk));\n\n      // Collect auxiliary assets (only remote-assets for now)\n      assets\n        .filter((asset) => /^remote-assets/.test(asset.name))\n        .forEach((asset) => auxiliaryAssets.add(asset.name));\n\n      let localAssetsCopyProcessor;\n      let { bundleFilename, sourceMapFilename, assetsPath } =\n        this.config.output;\n\n      if (bundleFilename) {\n        bundleFilename = this.ensureAbsolutePath(bundleFilename);\n\n        const bundlePath = path.dirname(bundleFilename);\n\n        sourceMapFilename = this.ensureAbsolutePath(\n          sourceMapFilename || `${bundleFilename}.map`\n        );\n\n        assetsPath = assetsPath || bundlePath;\n\n        logger.debug('Detected output paths:', {\n          bundleFilename,\n          bundlePath,\n          sourceMapFilename,\n          assetsPath,\n        });\n\n        localAssetsCopyProcessor = new AssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          bundleOutput: bundleFilename,\n          bundleOutputDir: bundlePath,\n          sourcemapOutput: sourceMapFilename,\n          assetsDest: assetsPath,\n          logger,\n        });\n      }\n\n      const remoteAssetsCopyProcessors: Record<string, AssetsCopyProcessor> =\n        {};\n\n      for (const chunk of localChunks) {\n        // Process entry chunk - only one entry chunk is allowed here\n        localAssetsCopyProcessor?.enqueueChunk(chunk, {\n          isEntry: chunk.id! === nativeEntryChunkName,\n          sourceMapFile: this.getRelatedSourceMap(chunk),\n        });\n      }\n\n      for (const chunk of remoteChunks) {\n        const specs = this.matchChunkToSpecs(chunk, remoteSpecs);\n\n        if (specs.length === 0) {\n          throw new Error(`No spec found for chunk ${chunk.id}`);\n        }\n        if (specs.length > 1) {\n          logger.warn(`Multiple specs found for chunk ${chunk.id}`);\n        }\n\n        const spec = specs[0] as { outputPath: string };\n        const specOutputPath = this.ensureAbsolutePath(spec.outputPath);\n\n        if (!remoteAssetsCopyProcessors[specOutputPath]) {\n          remoteAssetsCopyProcessors[specOutputPath] = new AssetsCopyProcessor({\n            platform: this.config.platform,\n            outputPath,\n            bundleOutput: '',\n            bundleOutputDir: specOutputPath,\n            sourcemapOutput: '',\n            assetsDest: specOutputPath,\n            logger,\n          });\n        }\n\n        remoteAssetsCopyProcessors[specOutputPath].enqueueChunk(chunk, {\n          isEntry: false,\n          sourceMapFile: this.getRelatedSourceMap(chunk),\n        });\n      }\n\n      let auxiliaryAssetsCopyProcessor;\n      const auxiliaryAssetsPath = this.config.output.auxiliaryAssetsPath;\n      if (auxiliaryAssetsPath) {\n        auxiliaryAssetsCopyProcessor = new AuxiliaryAssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          assetsDest: this.ensureAbsolutePath(auxiliaryAssetsPath),\n          logger,\n        });\n\n        for (const asset of auxiliaryAssets) {\n          auxiliaryAssetsCopyProcessor.enqueueAsset(asset);\n        }\n      }\n\n      await Promise.all([\n        ...(localAssetsCopyProcessor?.execute() ?? []),\n        ...Object.values(remoteAssetsCopyProcessors).reduce(\n          (acc, processor) => acc.concat(...processor.execute()),\n          [] as Promise<void>[]\n        ),\n        ...(auxiliaryAssetsCopyProcessor?.execute() ?? []),\n      ]);\n    });\n  }\n}"],"mappings":"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","ignoreList":[]}