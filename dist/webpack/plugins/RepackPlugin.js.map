{"version":3,"file":"RepackPlugin.js","names":["RepackPlugin","constructor","config","sourceMaps","logger","apply","compiler","webpack","DefinePlugin","__DEV__","JSON","stringify","mode","__E2E__","process","env","E2E","AssetsResolverPlugin","platform","OutputPlugin","enabled","devServer","context","output","extraChunks","DevelopmentPlugin","RepackTargetPlugin","hmr","SourceMapDevToolPlugin","test","exclude","filename","append","include","LoggerPlugin","devServerEnabled","Boolean","console"],"sources":["../../../src/webpack/plugins/RepackPlugin.ts"],"sourcesContent":["import webpack from 'webpack';\nimport type { DevServerOptions, WebpackPlugin } from '../../types';\nimport { AssetsResolverPlugin } from './AssetsResolverPlugin';\nimport { DevelopmentPlugin } from './DevelopmentPlugin';\nimport { LoggerPlugin, LoggerPluginConfig } from './LoggerPlugin';\nimport { OutputPlugin, OutputPluginConfig } from './OutputPlugin';\nimport { RepackTargetPlugin } from './RepackTargetPlugin';\n\n/**\n * {@link RepackPlugin} configuration options.\n */\nexport interface RepackPluginConfig {\n  /** Context in which all resolution happens. Usually it's project root directory. */\n  context: string;\n\n  /** Compilation mode. */\n  mode: 'development' | 'production';\n\n  /** Target application platform. */\n  platform: string;\n\n  /**\n   * Development server configuration options.\n   * Used to configure `@callstack/repack-dev-server`.\n   *\n   * If `undefined`, then development server will not be used.\n   */\n  devServer?: DevServerOptions;\n\n  /**\n   * Whether source maps should be generated. Defaults to `true`.\n   *\n   * Setting this to `false`, disables any source map generation.\n   */\n  sourceMaps?: boolean;\n\n  /**\n   * Output options specifying where to save generated bundle, source map and assets.\n   *\n   * Refer to {@link OutputPluginConfig.output} for more details.\n   */\n  output: OutputPluginConfig['output'];\n\n  /** The entry chunk name, `main` by default. */\n  entryName?: string;\n\n  /**\n   * Options specifying how to deal with extra chunks generated in the compilation,\n   * usually by using dynamic `import(...)` function.\n   *\n   * Refer to {@link OutputPluginConfig.extraChunks} for more details.\n   */\n  extraChunks?: OutputPluginConfig['extraChunks'];\n\n  /**\n   * Options to configure {@link LoggerPlugin}'s `output`.\n   *\n   * Setting this to `false` disables {@link LoggerPlugin}.\n   */\n  logger?: LoggerPluginConfig['output'] | boolean;\n}\n\n/**\n * Webpack plugin, which abstracts configuration of other Re.Pack's plugin\n * to make Webpack config more readable.\n *\n * @example Usage in Webpack config (ESM):\n * ```ts\n * import * as Repack from '@callstack/repack';\n *\n * export default (env) => {\n *   const {\n *     mode = 'development',\n *     platform,\n *     devServer = undefined,\n *   } = env;\n *\n *   return {\n *     plugins: [\n *       new Repack.RepackPlugin({\n *         mode,\n *         platform,\n *         devServer,\n *       }),\n *     ],\n *   };\n * };\n * ```\n *\n * Internally, `RepackPlugin` configures the following plugins:\n * - `webpack.DefinePlugin` with `__DEV__` global\n * - {@link AssetsResolverPlugin}\n * - {@link OutputPlugin}\n * - {@link DevelopmentPlugin}\n * - {@link RepackTargetPlugin}\n * - `webpack.SourceMapDevToolPlugin`\n * - {@link LoggerPlugin}\n *\n * `RepackPlugin` provides a sensible defaults, but can be customized to some extent.\n * If you need more control, it's recommended to remove `RepackPlugin` and use other plugins\n * directly, eg:\n * ```ts\n * import React from '@callstack/repack';\n *\n * new Repact.plugins.AssetsResolverPlugin();\n * ```\n *\n * @category Webpack Plugin\n */\nexport class RepackPlugin implements WebpackPlugin {\n  /**\n   * Constructs new `RepackPlugin`.\n   *\n   * @param config Plugin configuration options.\n   */\n  constructor(private config: RepackPluginConfig) {\n    this.config.sourceMaps = this.config.sourceMaps ?? true;\n    this.config.logger = this.config.logger ?? true;\n  }\n\n  /**\n   * Apply the plugin.\n   *\n   * @param compiler Webpack compiler instance.\n   */\n  apply(compiler: webpack.Compiler) {\n    new webpack.DefinePlugin({\n      __DEV__: JSON.stringify(this.config.mode === 'development'),\n      __E2E__: JSON.stringify(process.env.E2E),\n    }).apply(compiler);\n\n    new AssetsResolverPlugin({\n      platform: this.config.platform,\n    }).apply(compiler);\n\n    new OutputPlugin({\n      platform: this.config.platform,\n      enabled: !this.config.devServer,\n      context: this.config.context,\n      output: this.config.output,\n      extraChunks: this.config.extraChunks,\n    }).apply(compiler);\n\n    new DevelopmentPlugin({\n      platform: this.config.platform,\n      devServer: this.config.devServer,\n    }).apply(compiler);\n\n    new RepackTargetPlugin({\n      hmr: this.config.devServer?.hmr,\n    }).apply(compiler);\n\n    if (this.config.sourceMaps) {\n      new webpack.SourceMapDevToolPlugin({\n        test: /\\.(js)?bundle$/,\n        exclude: /\\.chunk\\.(js)?bundle$/,\n        filename: '[file].map',\n        append: `//# sourceMappingURL=[url]?platform=${this.config.platform}`,\n      }).apply(compiler);\n\n      new webpack.SourceMapDevToolPlugin({\n        test: /\\.(js)?bundle$/,\n        include: /\\.chunk\\.(js)?bundle$/,\n        filename: '[file].map',\n        append: `//# sourceMappingURL=[url]?platform=${this.config.platform}`,\n      }).apply(compiler);\n    }\n\n    if (this.config.logger) {\n      new LoggerPlugin({\n        platform: this.config.platform,\n        devServerEnabled: Boolean(this.config.devServer),\n        output: {\n          console: true,\n          ...(typeof this.config.logger === 'object' ? this.config.logger : {}),\n        },\n      }).apply(compiler);\n    }\n  }\n}\n"],"mappings":"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"}