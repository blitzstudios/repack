{"version":3,"file":"OutputPlugin.js","names":["_nodeAssert","_interopRequireDefault","require","_nodePath","_AssetsCopyProcessor","_AuxiliaryAssetsCopyProcessor","_config","e","__esModule","default","OutputPlugin","localSpecs","remoteSpecs","constructor","config","validateConfig","enabled","entryName","extraChunks","include","type","outputPath","path","join","context","platform","forEach","spec","push","createChunkMatcher","matchObject","chunk","specs","chunkIds","names","id","flat","filter","test","exclude","some","toString","getRelatedSourceMap","auxiliaryFiles","find","file","ensureAbsolutePath","filePath","isAbsolute","classifyChunks","chunks","chunkMatcher","entryOptions","localChunks","Set","remoteChunks","chunksById","Map","map","initial","entry","add","has","flatMap","siblings","chunkId","get","length","addParentsOfLocalChunks","parents","size","apply","compiler","assert","options","output","logger","getInfrastructureLogger","webpack","ModuleFilenameHelpers","matchChunkToSpecs","auxiliaryAssets","hooks","done","tapPromise","stats","compilationStats","toJson","all","assets","chunkRelations","ids","asset","name","localAssetsCopyProcessor","bundleFilename","sourceMapFilename","assetsPath","bundlePath","dirname","debug","JSON","stringify","AssetsCopyProcessor","bundleOutput","bundleOutputDir","sourcemapOutput","assetsDest","remoteAssetsCopyProcessors","enqueueChunk","isEntry","sourceMapFile","Error","warn","specOutputPath","auxiliaryAssetsCopyProcessor","auxiliaryAssetsPath","AuxiliaryAssetsCopyProcessor","enqueueAsset","Promise","execute","Object","values","reduce","acc","processor","concat","exports"],"sources":["../../../src/plugins/OutputPlugin/OutputPlugin.ts"],"sourcesContent":["import assert from 'node:assert';\nimport path from 'node:path';\nimport type {\n  Compiler,\n  EntryNormalized,\n  ModuleFilenameHelpers,\n  RspackPluginInstance,\n  StatsChunk,\n} from '@rspack/core';\nimport { AssetsCopyProcessor } from '../utils/AssetsCopyProcessor';\nimport { AuxiliaryAssetsCopyProcessor } from '../utils/AuxiliaryAssetsCopyProcessor';\nimport { validateConfig } from './config';\nimport type { DestinationSpec, OutputPluginConfig } from './types';\n\n/**\n * Plugin for copying generated files (bundle, chunks, assets) from Webpack's built location to the\n * React Native application directory, so that the files can be packed together into the `ipa`/`apk`.\n *\n * @category Webpack Plugin\n */\nexport class OutputPlugin implements RspackPluginInstance {\n  localSpecs: DestinationSpec[] = [];\n  remoteSpecs: DestinationSpec[] = [];\n\n  constructor(private config: OutputPluginConfig) {\n    validateConfig(config);\n\n    this.config.enabled = this.config.enabled ?? true;\n    this.config.entryName = this.config.entryName ?? 'main';\n    this.config.extraChunks = this.config.extraChunks ?? [\n      {\n        include: /.*/,\n        type: 'remote',\n        outputPath: path.join(\n          this.config.context,\n          'build/outputs',\n          this.config.platform,\n          'remotes'\n        ),\n      },\n    ];\n\n    this.config.extraChunks?.forEach((spec) => {\n      if (spec.type === 'local') this.localSpecs.push(spec);\n      if (spec.type === 'remote') this.remoteSpecs.push(spec);\n    });\n  }\n\n  createChunkMatcher(matchObject: typeof ModuleFilenameHelpers.matchObject) {\n    return (chunk: StatsChunk, specs: DestinationSpec[]) => {\n      const chunkIds = [chunk.names ?? [], chunk.id!].flat();\n      return specs.filter((spec) => {\n        const { test, include, exclude } = spec;\n        const config = { test, include, exclude };\n        return chunkIds.some((id) => matchObject(config, id.toString()));\n      });\n    };\n  }\n\n  getRelatedSourceMap(chunk: StatsChunk) {\n    return chunk.auxiliaryFiles?.find((file) => /\\.map$/.test(file));\n  }\n\n  ensureAbsolutePath(filePath: string) {\n    if (path.isAbsolute(filePath)) return filePath;\n    return path.join(this.config.context, filePath);\n  }\n\n  classifyChunks({\n    chunks,\n    chunkMatcher,\n    entryOptions,\n  }: {\n    chunks: StatsChunk[];\n    chunkMatcher: (\n      chunk: StatsChunk,\n      specs: DestinationSpec[]\n    ) => DestinationSpec[];\n    entryOptions: EntryNormalized;\n  }) {\n    const localChunks = new Set<StatsChunk>();\n    const remoteChunks = new Set<StatsChunk>();\n\n    const chunksById = new Map(chunks.map((chunk) => [chunk.id!, chunk]));\n\n    // Add explicitly known initial chunks as local chunks\n    chunks\n      .filter((chunk) => chunk.initial && chunk.entry)\n      .filter((chunk) => chunk.id! in entryOptions)\n      .forEach((chunk) => localChunks.add(chunk));\n\n    // Add siblings of known initial chunks as local chunks\n    chunks\n      .filter((chunk) => localChunks.has(chunk))\n      .flatMap((chunk) => chunk.siblings!)\n      .map((chunkId) => chunksById.get(chunkId))\n      .forEach((chunk) => localChunks.add(chunk!));\n\n    // Add chunks matching local specs as local chunks\n    chunks\n      .filter((chunk) => chunkMatcher(chunk, this.localSpecs).length)\n      .forEach((chunk) => localChunks.add(chunk));\n\n    // Add parents of local chunks as local chunks\n    const addParentsOfLocalChunks = () => {\n      chunks\n        .filter((chunk) => localChunks.has(chunk))\n        .flatMap((chunk) => chunk.parents!)\n        .map((chunkId) => chunksById.get(chunkId))\n        .forEach((chunk) => localChunks.add(chunk!));\n      return localChunks.size;\n    };\n\n    // Iterate until no new chunks are added\n    while (localChunks.size - addParentsOfLocalChunks());\n\n    // Add all other chunks as remote chunks\n    chunks\n      .filter((chunk) => !localChunks.has(chunk))\n      .forEach((chunk) => remoteChunks.add(chunk));\n\n    return { localChunks, remoteChunks };\n  }\n\n  /**\n   * Apply the plugin.\n   *\n   * @param compiler Webpack compiler instance.\n   */\n  apply(compiler: Compiler) {\n    if (!this.config.enabled) return;\n\n    assert(compiler.options.output.path, \"Can't infer output path from config\");\n\n    const logger = compiler.getInfrastructureLogger('RepackOutputPlugin');\n    const outputPath = compiler.options.output.path as string;\n\n    // use ModuleFilenameHelpers.matchObject from compiler.webpack for compatibility\n    const matchObject = compiler.webpack.ModuleFilenameHelpers.matchObject;\n    const matchChunkToSpecs = this.createChunkMatcher(matchObject);\n\n    const auxiliaryAssets = new Set<string>();\n\n    compiler.hooks.done.tapPromise('RepackOutputPlugin', async (stats) => {\n      const compilationStats = stats.toJson({\n        all: false,\n        assets: true,\n        chunks: true,\n        chunkRelations: true,\n        ids: true,\n      });\n\n      const assets = compilationStats.assets!;\n\n      const { localChunks, remoteChunks } = this.classifyChunks({\n        chunks: compilationStats.chunks!,\n        chunkMatcher: matchChunkToSpecs,\n        entryOptions: compiler.options.entry,\n      });\n\n      // Collect auxiliary assets (only remote-assets for now)\n      assets\n        .filter((asset) => /^remote-assets/.test(asset.name))\n        .forEach((asset) => auxiliaryAssets.add(asset.name));\n\n      let localAssetsCopyProcessor: AssetsCopyProcessor | undefined;\n      let { bundleFilename, sourceMapFilename, assetsPath } =\n        this.config.output;\n\n      if (bundleFilename) {\n        bundleFilename = this.ensureAbsolutePath(bundleFilename);\n\n        const bundlePath = path.dirname(bundleFilename);\n\n        sourceMapFilename = this.ensureAbsolutePath(\n          sourceMapFilename || `${bundleFilename}.map`\n        );\n\n        assetsPath = assetsPath || bundlePath;\n\n        logger.debug(\n          'Detected output paths:',\n          JSON.stringify({\n            bundleFilename,\n            bundlePath,\n            sourceMapFilename,\n            assetsPath,\n          })\n        );\n\n        localAssetsCopyProcessor = new AssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          bundleOutput: bundleFilename,\n          bundleOutputDir: bundlePath,\n          sourcemapOutput: sourceMapFilename,\n          assetsDest: assetsPath,\n          logger,\n        });\n      }\n\n      const remoteAssetsCopyProcessors: Record<string, AssetsCopyProcessor> =\n        {};\n\n      for (const chunk of localChunks) {\n        // Process entry chunk - only one entry chunk is allowed here\n        localAssetsCopyProcessor?.enqueueChunk(chunk, {\n          isEntry: chunk.id! === this.config.entryName,\n          sourceMapFile: this.getRelatedSourceMap(chunk),\n        });\n      }\n\n      for (const chunk of remoteChunks) {\n        const specs = matchChunkToSpecs(chunk, this.remoteSpecs);\n\n        if (specs.length === 0) {\n          throw new Error(`No spec found for chunk ${chunk.id}`);\n        }\n        if (specs.length > 1) {\n          logger.warn(`Multiple specs found for chunk ${chunk.id}`);\n        }\n\n        const spec = specs[0] as { outputPath: string };\n        const specOutputPath = this.ensureAbsolutePath(spec.outputPath);\n\n        if (!remoteAssetsCopyProcessors[specOutputPath]) {\n          remoteAssetsCopyProcessors[specOutputPath] = new AssetsCopyProcessor({\n            platform: this.config.platform,\n            outputPath,\n            bundleOutput: '',\n            bundleOutputDir: specOutputPath,\n            sourcemapOutput: '',\n            assetsDest: specOutputPath,\n            logger,\n          });\n        }\n\n        remoteAssetsCopyProcessors[specOutputPath].enqueueChunk(chunk, {\n          isEntry: false,\n          sourceMapFile: this.getRelatedSourceMap(chunk),\n        });\n      }\n\n      let auxiliaryAssetsCopyProcessor:\n        | AuxiliaryAssetsCopyProcessor\n        | undefined;\n      const auxiliaryAssetsPath = this.config.output.auxiliaryAssetsPath;\n      if (auxiliaryAssetsPath) {\n        auxiliaryAssetsCopyProcessor = new AuxiliaryAssetsCopyProcessor({\n          platform: this.config.platform,\n          outputPath,\n          assetsDest: this.ensureAbsolutePath(auxiliaryAssetsPath),\n          logger,\n        });\n\n        for (const asset of auxiliaryAssets) {\n          auxiliaryAssetsCopyProcessor.enqueueAsset(asset);\n        }\n      }\n\n      await Promise.all([\n        ...(localAssetsCopyProcessor?.execute() ?? []),\n        ...Object.values(remoteAssetsCopyProcessors).reduce(\n          (acc, processor) => acc.concat(...processor.execute()),\n          [] as Promise<void>[]\n        ),\n        ...(auxiliaryAssetsCopyProcessor?.execute() ?? []),\n      ]);\n    });\n  }\n}\n"],"mappings":"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","ignoreList":[]}