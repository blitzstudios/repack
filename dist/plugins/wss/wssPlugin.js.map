{"version":3,"file":"wssPlugin.js","names":["fastifyPlugin","WebSocketRouter","WebSocketServerAdapter","WebSocketApiServer","WebSocketDevClientServer","WebSocketEventsServer","WebSocketHMRServer","WebSocketMessageServer","WS_DEVICE_URL","WS_DEBUGGER_URL","wssPlugin","instance","options","delegate","router","devClientServer","messageServer","eventsServer","webSocketMessageServer","apiServer","hmrServer","hmr","deviceConnectionServer","endpoints","debuggerConnectionServer","registerServer","decorate","name"],"sources":["../../../src/plugins/wss/wssPlugin.ts"],"sourcesContent":["import type { FastifyInstance } from 'fastify';\nimport fastifyPlugin from 'fastify-plugin';\nimport type { Server } from '../../types';\nimport { WebSocketRouter } from './WebSocketRouter';\nimport { WebSocketServerAdapter } from './WebSocketServerAdapter';\nimport { WebSocketApiServer } from './servers/WebSocketApiServer';\nimport { WebSocketDevClientServer } from './servers/WebSocketDevClientServer';\nimport { WebSocketEventsServer } from './servers/WebSocketEventsServer';\nimport { WebSocketHMRServer } from './servers/WebSocketHMRServer';\nimport { WebSocketMessageServer } from './servers/WebSocketMessageServer';\n\ndeclare module 'fastify' {\n  interface FastifyInstance {\n    wss: {\n      devClientServer: WebSocketDevClientServer;\n      messageServer: WebSocketMessageServer;\n      eventsServer: WebSocketEventsServer;\n      apiServer: WebSocketApiServer;\n      hmrServer: WebSocketHMRServer;\n      deviceConnectionServer: WebSocketServerAdapter;\n      debuggerConnectionServer: WebSocketServerAdapter;\n      router: WebSocketRouter;\n    };\n  }\n}\n\n/**\n * Defined in @react-native/dev-middleware\n * Reference: https://github.com/facebook/react-native/blob/main/packages/dev-middleware/src/inspector-proxy/InspectorProxy.js\n */\nconst WS_DEVICE_URL = '/inspector/device';\nconst WS_DEBUGGER_URL = '/inspector/debug';\n\nasync function wssPlugin(\n  instance: FastifyInstance,\n  {\n    options,\n    delegate,\n  }: {\n    options: Server.Options;\n    delegate: Server.Delegate;\n  }\n) {\n  const router = new WebSocketRouter(instance);\n\n  const devClientServer = new WebSocketDevClientServer(instance);\n  const messageServer = new WebSocketMessageServer(instance);\n  const eventsServer = new WebSocketEventsServer(instance, {\n    webSocketMessageServer: messageServer,\n  });\n  const apiServer = new WebSocketApiServer(instance);\n  const hmrServer = new WebSocketHMRServer(instance, delegate.hmr);\n\n  // @react-native/dev-middleware servers\n  const deviceConnectionServer = new WebSocketServerAdapter(\n    instance,\n    WS_DEVICE_URL,\n    options.endpoints?.[WS_DEVICE_URL]\n  );\n\n  const debuggerConnectionServer = new WebSocketServerAdapter(\n    instance,\n    WS_DEBUGGER_URL,\n    options.endpoints?.[WS_DEBUGGER_URL]\n  );\n\n  router.registerServer(devClientServer);\n  router.registerServer(messageServer);\n  router.registerServer(eventsServer);\n  router.registerServer(apiServer);\n  router.registerServer(hmrServer);\n  router.registerServer(deviceConnectionServer);\n  router.registerServer(debuggerConnectionServer);\n\n  instance.decorate('wss', {\n    devClientServer,\n    messageServer,\n    eventsServer,\n    apiServer,\n    hmrServer,\n    deviceConnectionServer,\n    debuggerConnectionServer,\n    router,\n  });\n}\n\nexport default fastifyPlugin(wssPlugin, {\n  name: 'wss-plugin',\n});\n"],"mappings":"AACA,OAAOA,aAAa,MAAM,gBAAgB;AAAC,SAElCC,eAAe;AAAA,SACfC,sBAAsB;AAAA,SACtBC,kBAAkB;AAAA,SAClBC,wBAAwB;AAAA,SACxBC,qBAAqB;AAAA,SACrBC,kBAAkB;AAAA,SAClBC,sBAAsB;AAiB/B;AACA;AACA;AACA;AACA,MAAMC,aAAa,GAAG,mBAAmB;AACzC,MAAMC,eAAe,GAAG,kBAAkB;AAE1C,eAAeC,SAASA,CACtBC,QAAyB,EACzB;EACEC,OAAO;EACPC;AAIF,CAAC,EACD;EACA,MAAMC,MAAM,GAAG,IAAIb,eAAe,CAACU,QAAQ,CAAC;EAE5C,MAAMI,eAAe,GAAG,IAAIX,wBAAwB,CAACO,QAAQ,CAAC;EAC9D,MAAMK,aAAa,GAAG,IAAIT,sBAAsB,CAACI,QAAQ,CAAC;EAC1D,MAAMM,YAAY,GAAG,IAAIZ,qBAAqB,CAACM,QAAQ,EAAE;IACvDO,sBAAsB,EAAEF;EAC1B,CAAC,CAAC;EACF,MAAMG,SAAS,GAAG,IAAIhB,kBAAkB,CAACQ,QAAQ,CAAC;EAClD,MAAMS,SAAS,GAAG,IAAId,kBAAkB,CAACK,QAAQ,EAAEE,QAAQ,CAACQ,GAAG,CAAC;;EAEhE;EACA,MAAMC,sBAAsB,GAAG,IAAIpB,sBAAsB,CACvDS,QAAQ,EACRH,aAAa,EACbI,OAAO,CAACW,SAAS,GAAGf,aAAa,CACnC,CAAC;EAED,MAAMgB,wBAAwB,GAAG,IAAItB,sBAAsB,CACzDS,QAAQ,EACRF,eAAe,EACfG,OAAO,CAACW,SAAS,GAAGd,eAAe,CACrC,CAAC;EAEDK,MAAM,CAACW,cAAc,CAACV,eAAe,CAAC;EACtCD,MAAM,CAACW,cAAc,CAACT,aAAa,CAAC;EACpCF,MAAM,CAACW,cAAc,CAACR,YAAY,CAAC;EACnCH,MAAM,CAACW,cAAc,CAACN,SAAS,CAAC;EAChCL,MAAM,CAACW,cAAc,CAACL,SAAS,CAAC;EAChCN,MAAM,CAACW,cAAc,CAACH,sBAAsB,CAAC;EAC7CR,MAAM,CAACW,cAAc,CAACD,wBAAwB,CAAC;EAE/Cb,QAAQ,CAACe,QAAQ,CAAC,KAAK,EAAE;IACvBX,eAAe;IACfC,aAAa;IACbC,YAAY;IACZE,SAAS;IACTC,SAAS;IACTE,sBAAsB;IACtBE,wBAAwB;IACxBV;EACF,CAAC,CAAC;AACJ;AAEA,eAAed,aAAa,CAACU,SAAS,EAAE;EACtCiB,IAAI,EAAE;AACR,CAAC,CAAC","ignoreList":[]}