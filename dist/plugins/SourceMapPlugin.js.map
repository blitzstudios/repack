{"version":3,"file":"SourceMapPlugin.js","names":["_ConfigurationError","require","SourceMapPlugin","constructor","config","apply","compiler","options","devtool","format","platform","name","devtoolNamespace","output","uniqueName","devtoolModuleFilenameTemplate","devtoolFallbackModuleFilenameTemplate","startsWith","ConfigurationError","hidden","includes","cheap","moduleMaps","noSources","webpack","SourceMapDevToolPlugin","test","filename","moduleFilenameTemplate","fallbackModuleFilenameTemplate","append","module","columns","namespace","exports"],"sources":["../../src/plugins/SourceMapPlugin.ts"],"sourcesContent":["import type { Compiler, RspackPluginInstance } from '@rspack/core';\nimport { ConfigurationError } from './utils/ConfigurationError.js';\n\ninterface SourceMapPluginConfig {\n  platform?: string;\n}\n\nexport class SourceMapPlugin implements RspackPluginInstance {\n  constructor(private config: SourceMapPluginConfig = {}) {}\n\n  apply(compiler: Compiler) {\n    // if devtool is explicitly set to false, skip generating source maps\n    if (!compiler.options.devtool) {\n      return;\n    }\n\n    const format = compiler.options.devtool;\n    // disable builtin sourcemap generation\n    compiler.options.devtool = false;\n\n    const platform = this.config.platform ?? (compiler.options.name as string);\n\n    // explicitly fallback to uniqueName if devtoolNamespace is not set\n    const devtoolNamespace =\n      compiler.options.output.devtoolNamespace ??\n      compiler.options.output.uniqueName;\n    const devtoolModuleFilenameTemplate =\n      compiler.options.output.devtoolModuleFilenameTemplate;\n    const devtoolFallbackModuleFilenameTemplate =\n      compiler.options.output.devtoolFallbackModuleFilenameTemplate;\n\n    if (format.startsWith('eval')) {\n      throw new ConfigurationError(\n        '[RepackSourceMapPlugin] Eval source maps are not supported. ' +\n          'Please use a different setting for `config.devtool`.'\n      );\n    }\n\n    if (format.startsWith('inline')) {\n      throw new ConfigurationError(\n        '[RepackSourceMapPlugin] Inline source maps are not supported. ' +\n          'Please use a different setting for `config.devtool`.'\n      );\n    }\n\n    const hidden = format.includes('hidden');\n    const cheap = format.includes('cheap');\n    const moduleMaps = format.includes('module');\n    const noSources = format.includes('nosources');\n\n    // TODO Fix sourcemap directory structure\n    // Right now its very messy and not every node module is inside of the node module\n    // like React Devtools backend etc or some symilinked module appear with relative path\n    // We should normalize this through a custom handler and provide an output similar to Metro\n    new compiler.webpack.SourceMapDevToolPlugin({\n      test: /\\.([cm]?jsx?|bundle)$/,\n      filename: '[file].map',\n      moduleFilenameTemplate: devtoolModuleFilenameTemplate,\n      fallbackModuleFilenameTemplate: devtoolFallbackModuleFilenameTemplate,\n      append: hidden\n        ? false\n        : `//# sourceMappingURL=[url]?platform=${platform}`,\n      module: moduleMaps ? true : !cheap,\n      columns: !cheap,\n      noSources,\n      namespace: devtoolNamespace,\n    }).apply(compiler);\n  }\n}\n"],"mappings":";;;;;;AACA,IAAAA,mBAAA,GAAAC,OAAA;AAMO,MAAMC,eAAe,CAAiC;EAC3DC,WAAWA,CAASC,MAA6B,GAAG,CAAC,CAAC,EAAE;IAAA,KAApCA,MAA6B,GAA7BA,MAA6B;EAAQ;EAEzDC,KAAKA,CAACC,QAAkB,EAAE;IACxB;IACA,IAAI,CAACA,QAAQ,CAACC,OAAO,CAACC,OAAO,EAAE;MAC7B;IACF;IAEA,MAAMC,MAAM,GAAGH,QAAQ,CAACC,OAAO,CAACC,OAAO;IACvC;IACAF,QAAQ,CAACC,OAAO,CAACC,OAAO,GAAG,KAAK;IAEhC,MAAME,QAAQ,GAAG,IAAI,CAACN,MAAM,CAACM,QAAQ,IAAKJ,QAAQ,CAACC,OAAO,CAACI,IAAe;;IAE1E;IACA,MAAMC,gBAAgB,GACpBN,QAAQ,CAACC,OAAO,CAACM,MAAM,CAACD,gBAAgB,IACxCN,QAAQ,CAACC,OAAO,CAACM,MAAM,CAACC,UAAU;IACpC,MAAMC,6BAA6B,GACjCT,QAAQ,CAACC,OAAO,CAACM,MAAM,CAACE,6BAA6B;IACvD,MAAMC,qCAAqC,GACzCV,QAAQ,CAACC,OAAO,CAACM,MAAM,CAACG,qCAAqC;IAE/D,IAAIP,MAAM,CAACQ,UAAU,CAAC,MAAM,CAAC,EAAE;MAC7B,MAAM,IAAIC,sCAAkB,CAC1B,8DAA8D,GAC5D,sDACJ,CAAC;IACH;IAEA,IAAIT,MAAM,CAACQ,UAAU,CAAC,QAAQ,CAAC,EAAE;MAC/B,MAAM,IAAIC,sCAAkB,CAC1B,gEAAgE,GAC9D,sDACJ,CAAC;IACH;IAEA,MAAMC,MAAM,GAAGV,MAAM,CAACW,QAAQ,CAAC,QAAQ,CAAC;IACxC,MAAMC,KAAK,GAAGZ,MAAM,CAACW,QAAQ,CAAC,OAAO,CAAC;IACtC,MAAME,UAAU,GAAGb,MAAM,CAACW,QAAQ,CAAC,QAAQ,CAAC;IAC5C,MAAMG,SAAS,GAAGd,MAAM,CAACW,QAAQ,CAAC,WAAW,CAAC;;IAE9C;IACA;IACA;IACA;IACA,IAAId,QAAQ,CAACkB,OAAO,CAACC,sBAAsB,CAAC;MAC1CC,IAAI,EAAE,uBAAuB;MAC7BC,QAAQ,EAAE,YAAY;MACtBC,sBAAsB,EAAEb,6BAA6B;MACrDc,8BAA8B,EAAEb,qCAAqC;MACrEc,MAAM,EAAEX,MAAM,GACV,KAAK,GACL,uCAAuCT,QAAQ,EAAE;MACrDqB,MAAM,EAAET,UAAU,GAAG,IAAI,GAAG,CAACD,KAAK;MAClCW,OAAO,EAAE,CAACX,KAAK;MACfE,SAAS;MACTU,SAAS,EAAErB;IACb,CAAC,CAAC,CAACP,KAAK,CAACC,QAAQ,CAAC;EACpB;AACF;AAAC4B,OAAA,CAAAhC,eAAA,GAAAA,eAAA","ignoreList":[]}