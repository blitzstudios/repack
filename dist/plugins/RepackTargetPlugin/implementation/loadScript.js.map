{"version":3,"file":"loadScript.js","names":["$caller$","$hmrEnabled$","$loadScript$","module","exports","loadScriptHandler","name","caller","done","referenceUrl","__webpack_require__","repack","shared","scriptManager","loadScript","then","catch","reason","console","error","type","target","src","loadHotUpdateHandler","url","fetch","response","ok","statusText","text","script","unstable_evaluateScript","eval","key","chunkId","undefined"],"sources":["../../../../src/plugins/RepackTargetPlugin/implementation/loadScript.ts"],"sourcesContent":["var $caller$: string;\nvar $hmrEnabled$: boolean;\nvar $loadScript$: RepackRuntimeGlobals.WebpackLoadScript;\n\nmodule.exports = function () {\n  function loadScriptHandler(\n    name: string,\n    caller: string | undefined,\n    done: (event?: RepackRuntimeGlobals.LoadScriptEvent) => void,\n    referenceUrl: string\n  ) {\n    if (__webpack_require__.repack.shared.scriptManager) {\n      __webpack_require__.repack.shared.scriptManager\n        .loadScript(name, caller, __webpack_require__, referenceUrl)\n        .then(function () {\n          done();\n          return;\n        })\n        .catch(function (reason) {\n          console.error('[RepackRuntime] Loading script failed:', reason);\n          done({ type: 'exec', target: { src: name } });\n        });\n    } else {\n      console.error('[RepackRuntime] Script manager was not provided');\n      done({ type: 'exec', target: { src: name } });\n    }\n  }\n\n  function loadHotUpdateHandler(\n    url: string,\n    done: (event?: RepackRuntimeGlobals.LoadScriptEvent) => void\n  ) {\n    if (!$hmrEnabled$) {\n      console.error('[RepackRuntime] Loading HMR update chunks is disabled');\n      done({ type: 'disabled', target: { src: url } });\n      return;\n    }\n\n    (\n      fetch(url).then(function (response) {\n        if (!response.ok) {\n          console.error(\n            '[RepackRuntime] Loading HMR update failed:',\n            response.statusText\n          );\n          done({ type: response.statusText, target: { src: url } });\n          return;\n        }\n\n        return response.text();\n      }) as Promise<string | undefined>\n    )\n      .then(function (script?: string) {\n        if (script) {\n          if (__webpack_require__.repack.shared.scriptManager) {\n            __webpack_require__.repack.shared.scriptManager.unstable_evaluateScript(\n              script,\n              url\n            );\n          } else {\n            eval(script);\n          }\n        }\n\n        return;\n      })\n      .catch(function (reason) {\n        console.error(\n          '[RepackRuntime] Loading HMR update chunk failed:',\n          reason\n        );\n        done({ type: 'exec', target: { src: url } });\n      });\n  }\n\n  $loadScript$ = function loadScript(\n    url: string,\n    done: (event?: RepackRuntimeGlobals.LoadScriptEvent) => void,\n    key?: string,\n    chunkId?: string\n  ) {\n    if (key && chunkId) {\n      loadScriptHandler(chunkId, $caller$, done, url);\n    } else if (key) {\n      // MF2 containers\n      loadScriptHandler(key, undefined, done, url);\n    } else {\n      loadHotUpdateHandler(url, done);\n    }\n  };\n};\n"],"mappings":"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","ignoreList":[]}