{"version":3,"file":"RepackPlugin.js","names":["_BabelPlugin","require","_DevelopmentPlugin","_LoggerPlugin","_NativeEntryPlugin","_index","_index2","_SourceMapPlugin","RepackPlugin","constructor","config","logger","undefined","apply","compiler","platform","options","name","webpack","DefinePlugin","__E2E__","JSON","stringify","process","env","E2E","__DEV__","mode","BabelPlugin","OutputPlugin","enabled","devServer","context","output","extraChunks","NativeEntryPlugin","initializeCoreLocation","initializeCore","RepackTargetPlugin","DevelopmentPlugin","listenerIP","SourceMapPlugin","LoggerPlugin","console","exports"],"sources":["../../src/plugins/RepackPlugin.ts"],"sourcesContent":["import type { Compiler, RspackPluginInstance } from '@rspack/core';\nimport { BabelPlugin } from './BabelPlugin.js';\nimport { DevelopmentPlugin } from './DevelopmentPlugin.js';\nimport { LoggerPlugin, type LoggerPluginConfig } from './LoggerPlugin.js';\nimport { NativeEntryPlugin } from './NativeEntryPlugin.js';\nimport { OutputPlugin, type OutputPluginConfig } from './OutputPlugin/index.js';\nimport { RepackTargetPlugin } from './RepackTargetPlugin/index.js';\nimport { SourceMapPlugin } from './SourceMapPlugin.js';\n\n/**\n * {@link RepackPlugin} configuration options.\n */\nexport interface RepackPluginConfig {\n  /** Target application platform. */\n  platform?: string;\n\n  /**\n   * Options to configure {@link LoggerPlugin}'s `output`.\n   *\n   * Setting this to `false` disables {@link LoggerPlugin}.\n   */\n  logger?: LoggerPluginConfig['output'] | boolean;\n\n  /**\n   * Output options specifying where to save generated bundle, source map and assets.\n   *\n   * Refer to {@link OutputPluginConfig.output} for more details.\n   */\n  output?: OutputPluginConfig['output'];\n\n  /**\n   * Absolute location to JS file with initialization logic for React Native.\n   * Useful if you want to built for out-of-tree platforms.\n   */\n  initializeCore?: string;\n\n  /**\n   * Options specifying how to deal with extra chunks generated in the compilation,\n   * usually by using dynamic `import(...)` function.\n   *\n   * Refer to {@link OutputPluginConfig.extraChunks} for more details.\n   */\n  extraChunks?: OutputPluginConfig['extraChunks'];\n\n  listenerIP?: string;\n}\n\n/**\n * Webpack plugin, which abstracts configuration of other Re.Pack's plugin\n * to make Webpack config more readable.\n *\n * @example Usage in Webpack config (ESM):\n * ```ts\n * import * as Repack from '@callstack/repack';\n *\n * export default (env) => {\n *   const {\n *     mode = 'development',\n *     platform,\n *   } = env;\n *\n *   return {\n *     plugins: [\n *       new Repack.RepackPlugin({\n *         platform,\n *       }),\n *     ],\n *   };\n * };\n * ```\n *\n * Internally, `RepackPlugin` configures the following plugins:\n * - `webpack.DefinePlugin` with `__DEV__` global\n * - {@link AssetsResolverPlugin}\n * - {@link OutputPlugin}\n * - {@link DevelopmentPlugin}\n * - {@link RepackTargetPlugin}\n * - `webpack.SourceMapDevToolPlugin`\n * - {@link LoggerPlugin}\n *\n * `RepackPlugin` provides a sensible defaults, but can be customized to some extent.\n * If you need more control, it's recommended to remove `RepackPlugin` and use other plugins\n * directly, eg:\n * ```ts\n * import * as Repack from '@callstack/repack';\n *\n * new Repack.plugins.AssetsResolverPlugin();\n * ```\n *\n * @category Webpack Plugin\n */\nexport class RepackPlugin implements RspackPluginInstance {\n  constructor(private config: RepackPluginConfig = {}) {\n    if (this.config.logger === undefined || this.config.logger === true) {\n      this.config.logger = {};\n    }\n  }\n\n  apply(compiler: Compiler) {\n    const platform = this.config.platform ?? (compiler.options.name as string);\n\n    new compiler.webpack.DefinePlugin({\n      __E2E__: JSON.stringify(process.env.E2E),\n      __DEV__: JSON.stringify(compiler.options.mode === 'development'),\n    }).apply(compiler);\n\n    new BabelPlugin().apply(compiler);\n\n    new OutputPlugin({\n      platform,\n      enabled: !compiler.options.devServer,\n      context: compiler.options.context!,\n      output: this.config.output ?? {},\n      extraChunks: this.config.extraChunks,\n    }).apply(compiler);\n\n    new NativeEntryPlugin({\n      initializeCoreLocation: this.config.initializeCore,\n    }).apply(compiler);\n\n    new RepackTargetPlugin().apply(compiler);\n\n    new DevelopmentPlugin({\n      platform,\n      listenerIP: this.config?.listenerIP,\n    }).apply(compiler);\n\n    new SourceMapPlugin({ platform }).apply(compiler);\n\n    if (typeof this.config.logger === 'object') {\n      new LoggerPlugin({\n        output: { console: true, ...this.config.logger },\n      }).apply(compiler);\n    }\n  }\n}\n"],"mappings":";;;;;;AACA,IAAAA,YAAA,GAAAC,OAAA;AACA,IAAAC,kBAAA,GAAAD,OAAA;AACA,IAAAE,aAAA,GAAAF,OAAA;AACA,IAAAG,kBAAA,GAAAH,OAAA;AACA,IAAAI,MAAA,GAAAJ,OAAA;AACA,IAAAK,OAAA,GAAAL,OAAA;AACA,IAAAM,gBAAA,GAAAN,OAAA;AAEA;AACA;AACA;;AAoCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMO,YAAY,CAAiC;EACxDC,WAAWA,CAASC,MAA0B,GAAG,CAAC,CAAC,EAAE;IAAA,KAAjCA,MAA0B,GAA1BA,MAA0B;IAC5C,IAAI,IAAI,CAACA,MAAM,CAACC,MAAM,KAAKC,SAAS,IAAI,IAAI,CAACF,MAAM,CAACC,MAAM,KAAK,IAAI,EAAE;MACnE,IAAI,CAACD,MAAM,CAACC,MAAM,GAAG,CAAC,CAAC;IACzB;EACF;EAEAE,KAAKA,CAACC,QAAkB,EAAE;IACxB,MAAMC,QAAQ,GAAG,IAAI,CAACL,MAAM,CAACK,QAAQ,IAAKD,QAAQ,CAACE,OAAO,CAACC,IAAe;IAE1E,IAAIH,QAAQ,CAACI,OAAO,CAACC,YAAY,CAAC;MAChCC,OAAO,EAAEC,IAAI,CAACC,SAAS,CAACC,OAAO,CAACC,GAAG,CAACC,GAAG,CAAC;MACxCC,OAAO,EAAEL,IAAI,CAACC,SAAS,CAACR,QAAQ,CAACE,OAAO,CAACW,IAAI,KAAK,aAAa;IACjE,CAAC,CAAC,CAACd,KAAK,CAACC,QAAQ,CAAC;IAElB,IAAIc,wBAAW,CAAC,CAAC,CAACf,KAAK,CAACC,QAAQ,CAAC;IAEjC,IAAIe,mBAAY,CAAC;MACfd,QAAQ;MACRe,OAAO,EAAE,CAAChB,QAAQ,CAACE,OAAO,CAACe,SAAS;MACpCC,OAAO,EAAElB,QAAQ,CAACE,OAAO,CAACgB,OAAQ;MAClCC,MAAM,EAAE,IAAI,CAACvB,MAAM,CAACuB,MAAM,IAAI,CAAC,CAAC;MAChCC,WAAW,EAAE,IAAI,CAACxB,MAAM,CAACwB;IAC3B,CAAC,CAAC,CAACrB,KAAK,CAACC,QAAQ,CAAC;IAElB,IAAIqB,oCAAiB,CAAC;MACpBC,sBAAsB,EAAE,IAAI,CAAC1B,MAAM,CAAC2B;IACtC,CAAC,CAAC,CAACxB,KAAK,CAACC,QAAQ,CAAC;IAElB,IAAIwB,0BAAkB,CAAC,CAAC,CAACzB,KAAK,CAACC,QAAQ,CAAC;IAExC,IAAIyB,oCAAiB,CAAC;MACpBxB,QAAQ;MACRyB,UAAU,EAAE,IAAI,CAAC9B,MAAM,EAAE8B;IAC3B,CAAC,CAAC,CAAC3B,KAAK,CAACC,QAAQ,CAAC;IAElB,IAAI2B,gCAAe,CAAC;MAAE1B;IAAS,CAAC,CAAC,CAACF,KAAK,CAACC,QAAQ,CAAC;IAEjD,IAAI,OAAO,IAAI,CAACJ,MAAM,CAACC,MAAM,KAAK,QAAQ,EAAE;MAC1C,IAAI+B,0BAAY,CAAC;QACfT,MAAM,EAAE;UAAEU,OAAO,EAAE,IAAI;UAAE,GAAG,IAAI,CAACjC,MAAM,CAACC;QAAO;MACjD,CAAC,CAAC,CAACE,KAAK,CAACC,QAAQ,CAAC;IACpB;EACF;AACF;AAAC8B,OAAA,CAAApC,YAAA,GAAAA,YAAA","ignoreList":[]}