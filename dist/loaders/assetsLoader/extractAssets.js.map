{"version":3,"file":"extractAssets.js","names":["_nodeCrypto","_interopRequireDefault","require","_nodePath","_dedent","_utils","e","__esModule","default","extractAssets","resourcePath","resourceDirname","resourceFilename","resourceExtensionType","assets","assetsDirname","pathSeparatorRegexp","publicPath","customPublicPath","isDev","logger","path","join","replace","size","getAssetSize","scales","map","asset","scale","hashes","crypto","createHash","update","data","digest","debug","JSON","stringify","height","width","dedent"],"sources":["../../../src/loaders/assetsLoader/extractAssets.ts"],"sourcesContent":["import crypto from 'node:crypto';\nimport path from 'node:path';\nimport dedent from 'dedent';\nimport type { Asset } from './types.js';\nimport { getAssetSize } from './utils.js';\n\nexport function extractAssets(\n  {\n    resourcePath,\n    resourceDirname,\n    resourceFilename,\n    resourceExtensionType,\n    assets,\n    assetsDirname,\n    pathSeparatorRegexp,\n    publicPath: customPublicPath,\n    isDev,\n  }: {\n    resourcePath: string;\n    resourceDirname: string;\n    resourceFilename: string;\n    resourceExtensionType: string;\n    assets: Asset[];\n    suffixPattern: string;\n    assetsDirname: string;\n    pathSeparatorRegexp: RegExp;\n    publicPath?: string;\n    isDev?: boolean;\n  },\n  logger: {\n    debug: (...args: string[]) => void;\n  }\n) {\n  let publicPath = path\n    .join(assetsDirname, resourceDirname)\n    .replace(pathSeparatorRegexp, '/');\n\n  if (customPublicPath) {\n    publicPath = path.join(customPublicPath, publicPath);\n  }\n\n  const size = getAssetSize(assets);\n  const scales = assets.map((asset) => asset.scale);\n  const hashes = assets.map((asset) =>\n    crypto.createHash('md5').update(asset.data).digest('hex')\n  );\n\n  logger.debug(\n    `Extracted assets for request ${resourcePath}`,\n    JSON.stringify({\n      hashes,\n      publicPath: customPublicPath,\n      height: size?.height,\n      width: size?.width,\n    })\n  );\n\n  return dedent`\n    var AssetRegistry = require('react-native/Libraries/Image/AssetRegistry');\n    module.exports = AssetRegistry.registerAsset({\n      __packager_asset: true,\n      scales: ${JSON.stringify(scales)},\n      name: ${JSON.stringify(resourceFilename)},\n      type: ${JSON.stringify(resourceExtensionType)},\n      hash: ${JSON.stringify(hashes.join())},\n      httpServerLocation: ${JSON.stringify(publicPath)},\n      ${isDev ? `fileSystemLocation: ${JSON.stringify(resourceDirname)},` : ''}\n      ${size ? `height: ${size.height},` : ''}\n      ${size ? `width: ${size.width},` : ''}\n    });\n    `;\n}\n"],"mappings":";;;;;;AAAA,IAAAA,WAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,OAAA,GAAAH,sBAAA,CAAAC,OAAA;AAEA,IAAAG,MAAA,GAAAH,OAAA;AAA0C,SAAAD,uBAAAK,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEnC,SAASG,aAAaA,CAC3B;EACEC,YAAY;EACZC,eAAe;EACfC,gBAAgB;EAChBC,qBAAqB;EACrBC,MAAM;EACNC,aAAa;EACbC,mBAAmB;EACnBC,UAAU,EAAEC,gBAAgB;EAC5BC;AAYF,CAAC,EACDC,MAEC,EACD;EACA,IAAIH,UAAU,GAAGI,iBAAI,CAClBC,IAAI,CAACP,aAAa,EAAEJ,eAAe,CAAC,CACpCY,OAAO,CAACP,mBAAmB,EAAE,GAAG,CAAC;EAEpC,IAAIE,gBAAgB,EAAE;IACpBD,UAAU,GAAGI,iBAAI,CAACC,IAAI,CAACJ,gBAAgB,EAAED,UAAU,CAAC;EACtD;EAEA,MAAMO,IAAI,GAAG,IAAAC,mBAAY,EAACX,MAAM,CAAC;EACjC,MAAMY,MAAM,GAAGZ,MAAM,CAACa,GAAG,CAAEC,KAAK,IAAKA,KAAK,CAACC,KAAK,CAAC;EACjD,MAAMC,MAAM,GAAGhB,MAAM,CAACa,GAAG,CAAEC,KAAK,IAC9BG,mBAAM,CAACC,UAAU,CAAC,KAAK,CAAC,CAACC,MAAM,CAACL,KAAK,CAACM,IAAI,CAAC,CAACC,MAAM,CAAC,KAAK,CAC1D,CAAC;EAEDf,MAAM,CAACgB,KAAK,CACV,gCAAgC1B,YAAY,EAAE,EAC9C2B,IAAI,CAACC,SAAS,CAAC;IACbR,MAAM;IACNb,UAAU,EAAEC,gBAAgB;IAC5BqB,MAAM,EAAEf,IAAI,EAAEe,MAAM;IACpBC,KAAK,EAAEhB,IAAI,EAAEgB;EACf,CAAC,CACH,CAAC;EAED,OAAO,IAAAC,eAAM;AACf;AACA;AACA;AACA,gBAAgBJ,IAAI,CAACC,SAAS,CAACZ,MAAM,CAAC;AACtC,cAAcW,IAAI,CAACC,SAAS,CAAC1B,gBAAgB,CAAC;AAC9C,cAAcyB,IAAI,CAACC,SAAS,CAACzB,qBAAqB,CAAC;AACnD,cAAcwB,IAAI,CAACC,SAAS,CAACR,MAAM,CAACR,IAAI,CAAC,CAAC,CAAC;AAC3C,4BAA4Be,IAAI,CAACC,SAAS,CAACrB,UAAU,CAAC;AACtD,QAAQE,KAAK,GAAG,uBAAuBkB,IAAI,CAACC,SAAS,CAAC3B,eAAe,CAAC,GAAG,GAAG,EAAE;AAC9E,QAAQa,IAAI,GAAG,WAAWA,IAAI,CAACe,MAAM,GAAG,GAAG,EAAE;AAC7C,QAAQf,IAAI,GAAG,UAAUA,IAAI,CAACgB,KAAK,GAAG,GAAG,EAAE;AAC3C;AACA,KAAK;AACL","ignoreList":[]}