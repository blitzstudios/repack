{"version":3,"file":"start.js","names":["_readline","_interopRequireDefault","require","_url","_path","_execa","_env","_logging","_Compiler","_getWebpackConfigPath","obj","__esModule","default","start","_","config","args","webpackConfigPath","getWebpackConfigPath","root","webpackConfig","reversePort","reversePortArg","sendEvents","sendEventsArg","restArgs","cliOptions","reactNativePath","command","arguments","platform","process","argv","includes","isSilent","silent","isVerbose","verbose","reporter","composeReporters","ConsoleReporter","asJson","json","level","logFile","FileReporter","filename","undefined","filter","Boolean","compiler","Compiler","createServer","stop","options","rootDir","host","DEFAULT_HOSTNAME","port","DEFAULT_PORT","https","cert","key","experiments","experimentalDebugger","delegate","ctx","interactive","bindKeypressInput","runAdbReverse","lastStats","on","console","log","notifyBuildStart","broadcastToHmrClients","action","stats","notifyBuildEnd","body","createHmrBody","getAsset","sendProgress","data","getMimeType","inferPlatform","uri","url","URL","searchParams","get","exec","pathname","symbolicator","getSource","fileUrl","parseFileUrl","getSourceMap","Error","shouldIncludeFrame","frame","test","file","hmr","getUriPath","onClientConnected","clientId","messages","getHello","getStatus","logger","onMessage","logEntry","makeLogEntryFromFastifyLog","issuer","api","getPlatforms","Promise","resolve","Object","keys","workers","getAssets","entries","assetsCache","map","name","asset","size","info","getCompilationStats","statsCache","sendEventsStop","sendEventsPath","path","join","stdin","setRawMode","warn","msg","readline","emitKeypressEvents","_key","ctrl","exit","emit","broadcastToMessageClients","method","adbPath","env","ANDROID_HOME","execa","error","message","split","trim","platformOrName","reverse","replace","modules","module","identifier","time","hash","warnings","errors"],"sources":["../../src/commands/start.ts"],"sourcesContent":["import readline from 'readline';\nimport { URL } from 'url';\nimport path from 'path';\nimport webpack from 'webpack';\nimport execa from 'execa';\nimport { Config } from '@react-native-community/cli-types';\nimport type { Server } from '@callstack/repack-dev-server';\nimport { CliOptions, HMRMessageBody, StartArguments } from '../types';\nimport { DEFAULT_HOSTNAME, DEFAULT_PORT } from '../env';\nimport {\n  composeReporters,\n  ConsoleReporter,\n  FileReporter,\n  makeLogEntryFromFastifyLog,\n  Reporter,\n} from '../logging';\nimport { Compiler } from '../webpack/Compiler';\nimport { getWebpackConfigPath } from './utils/getWebpackConfigPath';\n\n/**\n * Start command for React Native CLI.\n * It runs `@callstack/repack-dev-server` to provide Development Server functionality to React Native apps\n * in development mode.\n *\n * @param _ Original, non-parsed arguments that were provided when running this command.\n * @param config React Native CLI configuration object.\n * @param args Parsed command line arguments.\n *\n * @internal\n * @category CLI command\n */\nexport async function start(_: string[], config: Config, args: StartArguments) {\n  const webpackConfigPath = getWebpackConfigPath(\n    config.root,\n    args.webpackConfig\n  );\n  const { reversePort: reversePortArg, sendEvents: sendEventsArg, ...restArgs } = args;\n  const cliOptions: CliOptions = {\n    config: {\n      root: config.root,\n      reactNativePath: config.reactNativePath,\n      webpackConfigPath,\n    },\n    command: 'start',\n    arguments: {\n      // `platform` is empty, since it will be filled in later by `DevServerProxy`\n      start: { ...restArgs, platform: '' },\n    },\n  };\n\n  const reversePort = reversePortArg ?? process.argv.includes('--reverse-port');\n  const isSilent = args.silent;\n  const isVerbose = isSilent\n    ? false\n    : args.verbose ?? process.argv.includes('--verbose');\n  const reporter = composeReporters(\n    [\n      new ConsoleReporter({\n        asJson: args.json,\n        level: isSilent ? 'silent' : isVerbose ? 'verbose' : 'normal',\n      }),\n      args.logFile ? new FileReporter({ filename: args.logFile }) : undefined,\n    ].filter(Boolean) as Reporter[]\n  );\n  const compiler = new Compiler(cliOptions, reporter, isVerbose);\n\n  const { createServer } = await import('@callstack/repack-dev-server');\n  const { start, stop } = await createServer({\n    options: {\n      rootDir: cliOptions.config.root,\n      host: args.host || DEFAULT_HOSTNAME,\n      port: args.port ?? DEFAULT_PORT,\n      https: args.https\n        ? {\n            cert: args.cert,\n            key: args.key,\n          }\n        : undefined,\n    },\n    experiments: {\n      experimentalDebugger: args.experimentalDebugger,\n    },\n    delegate: (ctx): Server.Delegate => {\n      if (args.interactive) {\n        bindKeypressInput(ctx);\n      }\n\n      if (reversePort && args.port) {\n        void runAdbReverse(ctx, args.port);\n      }\n\n      const lastStats: Record<string, webpack.StatsCompilation> = {};\n\n      compiler.on('watchRun', ({ platform }) => {\n        console.log('[CompilerPlugin] hook: watchRun');\n        ctx.notifyBuildStart(platform);\n        if (platform === 'android') {\n          void runAdbReverse(ctx, args.port ?? DEFAULT_PORT);\n        }\n      });\n\n      compiler.on('invalid', ({ platform }) => {\n        console.log('[CompilerPlugin] hook: invalid');\n        ctx.notifyBuildStart(platform);\n        ctx.broadcastToHmrClients({ action: 'building' }, platform);\n      });\n\n      compiler.on(\n        'done',\n        ({\n          platform,\n          stats,\n        }: {\n          platform: string;\n          stats: webpack.StatsCompilation;\n        }) => {\n          console.log('[CompilerPlugin] hook: done');\n          ctx.notifyBuildEnd(platform);\n          lastStats[platform] = stats;\n          ctx.broadcastToHmrClients(\n            { action: 'built', body: createHmrBody(stats) },\n            platform\n          );\n        }\n      );\n\n      return {\n        compiler: {\n          getAsset: async (filename, platform, sendProgress) =>\n            (await compiler.getAsset(filename, platform, sendProgress)).data,\n          getMimeType: (filename) => compiler.getMimeType(filename),\n          inferPlatform: (uri) => {\n            const url = new URL(uri, 'protocol://domain');\n            if (!url.searchParams.get('platform')) {\n              const [, platform] = /^\\/(.+)\\/.+$/.exec(url.pathname) ?? [];\n              return platform;\n            }\n\n            return undefined;\n          },\n        },\n        symbolicator: {\n          getSource: (fileUrl) => {\n            const { filename, platform } = parseFileUrl(fileUrl);\n            return compiler.getSource(filename, platform);\n          },\n          getSourceMap: (fileUrl) => {\n            const { filename, platform } = parseFileUrl(fileUrl);\n            if (!platform) {\n              throw new Error('Cannot infer platform for file URL');\n            }\n\n            return compiler.getSourceMap(filename, platform);\n          },\n          shouldIncludeFrame: (frame) => {\n            // If the frame points to internal bootstrap/module system logic, skip the code frame.\n            return !/webpack[/\\\\]runtime[/\\\\].+\\s/.test(frame.file);\n          },\n        },\n        hmr: {\n          getUriPath: () => '/__hmr',\n          onClientConnected: (platform, clientId) => {\n            ctx.broadcastToHmrClients(\n              { action: 'sync', body: createHmrBody(lastStats[platform]) },\n              platform,\n              [clientId]\n            );\n          },\n        },\n        messages: {\n          getHello: () => 'React Native packager is running',\n          getStatus: () => 'packager-status:running',\n        },\n        logger: {\n          onMessage: (log) => {\n            const logEntry = makeLogEntryFromFastifyLog(log);\n            logEntry.issuer = 'DevServer';\n            reporter.process(logEntry);\n          },\n        },\n        api: {\n          getPlatforms: () => Promise.resolve(Object.keys(compiler.workers)),\n          getAssets: (platform) =>\n            Promise.resolve(\n              Object.entries(compiler.assetsCache[platform] ?? {}).map(\n                ([name, asset]) => ({\n                  name,\n                  size: asset.info.size,\n                })\n              )\n            ),\n          getCompilationStats: (platform) =>\n            Promise.resolve(compiler.statsCache[platform] ?? null),\n        },\n      };\n    },\n  });\n\n  await start();\n\n  let sendEventsStop = () => {};\n  if (sendEventsArg) {\n    const sendEventsPath = path.join(config.root, sendEventsArg);\n    const { default: sendEvents } = await import(sendEventsPath);\n    sendEventsStop = await sendEvents(config.root);\n  }\n\n  return {\n    stop: async () => {\n      reporter.stop();\n      sendEventsStop();\n      await stop();\n    },\n  };\n}\n\nfunction bindKeypressInput(ctx: Server.DelegateContext) {\n  if (!process.stdin.setRawMode) {\n    ctx.log.warn({\n      msg: 'Interactive mode is not supported in this environment',\n    });\n    return;\n  }\n\n  readline.emitKeypressEvents(process.stdin);\n  process.stdin.setRawMode(true);\n\n  process.stdin.on('keypress', (_key, data) => {\n    const { ctrl, name } = data;\n    if (ctrl === true) {\n      switch (name) {\n        case 'c':\n          process.exit();\n          break;\n        case 'z':\n          process.emit('SIGTSTP', 'SIGTSTP');\n          break;\n      }\n    } else if (name === 'r') {\n      ctx.broadcastToMessageClients({ method: 'reload' });\n      ctx.log.info({\n        msg: 'Reloading app',\n      });\n    } else if (name === 'd') {\n      ctx.broadcastToMessageClients({ method: 'devMenu' });\n      ctx.log.info({\n        msg: 'Opening developer menu',\n      });\n    }\n  });\n}\n\nasync function runAdbReverse(ctx: Server.DelegateContext, port: number) {\n  const adbPath = process.env.ANDROID_HOME\n    ? `${process.env.ANDROID_HOME}/platform-tools/adb`\n    : 'adb';\n  const command = `${adbPath} reverse tcp:${port} tcp:${port}`;\n  try {\n    await execa.command(command);\n    ctx.log.info(`Successfully run: ${command}`);\n  } catch (error) {\n    // Get just the error message\n    const message =\n      (error as Error).message.split('error:')[1] || (error as Error).message;\n    ctx.log.warn(`Failed to run: ${command} - ${message.trim()}`);\n  }\n}\n\nfunction parseFileUrl(fileUrl: string) {\n  const { pathname: filename, searchParams } = new URL(fileUrl);\n  let platform = searchParams.get('platform');\n  if (!platform) {\n    const [, platformOrName, name] = filename.split('.').reverse();\n    if (name !== undefined) {\n      platform = platformOrName;\n    }\n  }\n\n  return {\n    filename: filename.replace(/^\\//, ''),\n    platform: platform || undefined,\n  };\n}\n\nfunction createHmrBody(\n  stats?: webpack.StatsCompilation\n): HMRMessageBody | null {\n  if (!stats) {\n    return null;\n  }\n\n  const modules: Record<string, string> = {};\n  for (const module of stats.modules ?? []) {\n    const { identifier, name } = module;\n    if (identifier !== undefined && name) {\n      modules[identifier] = name;\n    }\n  }\n\n  return {\n    name: stats.name ?? '',\n    time: stats.time ?? 0,\n    hash: stats.hash ?? '',\n    warnings: stats.warnings || [],\n    errors: stats.errors || [],\n    modules,\n  };\n}\n"],"mappings":"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","ignoreList":[]}