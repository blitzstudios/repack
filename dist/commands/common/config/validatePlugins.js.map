{"version":3,"file":"validatePlugins.js","names":["_nodeFs","_interopRequireDefault","require","_nodePath","_colorette","e","__esModule","default","DEPENDENCIES_WITH_SEPARATE_PLUGINS","plugin","path","bundler","nativewind","expo","validatePlugins","rootDir","plugins","dependencies","activePlugins","Set","map","constructor","name","filter","pluginName","undefined","packageJsonPath","join","packageJson","fs","readFileSync","Object","keys","JSON","parse","error","code","console","debug","dependency","forEach","requiredPlugin","has","warn","bold"],"sources":["../../../../src/commands/common/config/validatePlugins.ts"],"sourcesContent":["import fs from 'node:fs';\nimport path from 'node:path';\nimport { bold } from 'colorette';\n\nconst DEPENDENCIES_WITH_SEPARATE_PLUGINS: Record<\n  string,\n  { plugin: string; path: string; bundler?: 'rspack' | 'webpack' }\n> = {\n  'react-native-reanimated': {\n    plugin: 'ReanimatedPlugin',\n    path: 'plugin-reanimated',\n    bundler: 'rspack',\n  },\n  nativewind: {\n    plugin: 'NativeWindPlugin',\n    path: 'plugin-nativewind',\n  },\n  expo: {\n    plugin: 'ExpoModulesPlugin',\n    path: 'plugin-expo-modules',\n  },\n} as const;\n\nexport async function validatePlugins(\n  rootDir: string,\n  plugins: unknown[],\n  bundler: 'rspack' | 'webpack'\n) {\n  let dependencies: string[] = [];\n\n  const activePlugins = new Set(\n    plugins\n      .map((plugin) => plugin?.constructor.name)\n      .filter((pluginName): pluginName is string => pluginName !== undefined)\n  );\n\n  try {\n    const packageJsonPath = path.join(rootDir, 'package.json');\n    const packageJson = fs.readFileSync(packageJsonPath, 'utf-8');\n    dependencies = Object.keys(JSON.parse(packageJson).dependencies || {});\n  } catch (error) {\n    if ((error as NodeJS.ErrnoException).code === 'ENOENT') {\n      console.debug(\n        'Could not find package.json in your project root:',\n        rootDir\n      );\n      return;\n    }\n\n    console.debug('Failed to parse package.json:', error);\n  }\n\n  dependencies\n    .filter((dependency) => {\n      const plugin = DEPENDENCIES_WITH_SEPARATE_PLUGINS[dependency];\n\n      if (!plugin) {\n        return false;\n      }\n\n      return plugin.bundler ? plugin.bundler === bundler : true;\n    })\n    .forEach((dependency) => {\n      const requiredPlugin = DEPENDENCIES_WITH_SEPARATE_PLUGINS[dependency];\n\n      if (!activePlugins.has(requiredPlugin.plugin)) {\n        console.warn(\n          `${bold('WARNING:')} Detected ${bold(dependency)} package which requires ${bold(requiredPlugin.plugin)} plugin but it's not configured. ` +\n            `Please add the following to your configuration file. \\nRead more https://github.com/callstack/repack/tree/main/packages/${requiredPlugin.path}/README.md.`\n        );\n      }\n    });\n}\n"],"mappings":";;;;;;AAAA,IAAAA,OAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,UAAA,GAAAF,OAAA;AAAiC,SAAAD,uBAAAI,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEjC,MAAMG,kCAGL,GAAG;EACF,yBAAyB,EAAE;IACzBC,MAAM,EAAE,kBAAkB;IAC1BC,IAAI,EAAE,mBAAmB;IACzBC,OAAO,EAAE;EACX,CAAC;EACDC,UAAU,EAAE;IACVH,MAAM,EAAE,kBAAkB;IAC1BC,IAAI,EAAE;EACR,CAAC;EACDG,IAAI,EAAE;IACJJ,MAAM,EAAE,mBAAmB;IAC3BC,IAAI,EAAE;EACR;AACF,CAAU;AAEH,eAAeI,eAAeA,CACnCC,OAAe,EACfC,OAAkB,EAClBL,OAA6B,EAC7B;EACA,IAAIM,YAAsB,GAAG,EAAE;EAE/B,MAAMC,aAAa,GAAG,IAAIC,GAAG,CAC3BH,OAAO,CACJI,GAAG,CAAEX,MAAM,IAAKA,MAAM,EAAEY,WAAW,CAACC,IAAI,CAAC,CACzCC,MAAM,CAAEC,UAAU,IAA2BA,UAAU,KAAKC,SAAS,CAC1E,CAAC;EAED,IAAI;IACF,MAAMC,eAAe,GAAGhB,iBAAI,CAACiB,IAAI,CAACZ,OAAO,EAAE,cAAc,CAAC;IAC1D,MAAMa,WAAW,GAAGC,eAAE,CAACC,YAAY,CAACJ,eAAe,EAAE,OAAO,CAAC;IAC7DT,YAAY,GAAGc,MAAM,CAACC,IAAI,CAACC,IAAI,CAACC,KAAK,CAACN,WAAW,CAAC,CAACX,YAAY,IAAI,CAAC,CAAC,CAAC;EACxE,CAAC,CAAC,OAAOkB,KAAK,EAAE;IACd,IAAKA,KAAK,CAA2BC,IAAI,KAAK,QAAQ,EAAE;MACtDC,OAAO,CAACC,KAAK,CACX,mDAAmD,EACnDvB,OACF,CAAC;MACD;IACF;IAEAsB,OAAO,CAACC,KAAK,CAAC,+BAA+B,EAAEH,KAAK,CAAC;EACvD;EAEAlB,YAAY,CACTM,MAAM,CAAEgB,UAAU,IAAK;IACtB,MAAM9B,MAAM,GAAGD,kCAAkC,CAAC+B,UAAU,CAAC;IAE7D,IAAI,CAAC9B,MAAM,EAAE;MACX,OAAO,KAAK;IACd;IAEA,OAAOA,MAAM,CAACE,OAAO,GAAGF,MAAM,CAACE,OAAO,KAAKA,OAAO,GAAG,IAAI;EAC3D,CAAC,CAAC,CACD6B,OAAO,CAAED,UAAU,IAAK;IACvB,MAAME,cAAc,GAAGjC,kCAAkC,CAAC+B,UAAU,CAAC;IAErE,IAAI,CAACrB,aAAa,CAACwB,GAAG,CAACD,cAAc,CAAChC,MAAM,CAAC,EAAE;MAC7C4B,OAAO,CAACM,IAAI,CACV,GAAG,IAAAC,eAAI,EAAC,UAAU,CAAC,aAAa,IAAAA,eAAI,EAACL,UAAU,CAAC,2BAA2B,IAAAK,eAAI,EAACH,cAAc,CAAChC,MAAM,CAAC,mCAAmC,GACvI,2HAA2HgC,cAAc,CAAC/B,IAAI,aAClJ,CAAC;IACH;EACF,CAAC,CAAC;AACN","ignoreList":[]}