{"version":3,"file":"bundle.js","names":["_webpack","_interopRequireDefault","require","_cliError","_makeCompilerConfig","_index","_setupEnvironment","e","__esModule","default","bundle","_","cliConfig","args","config","makeCompilerConfig","bundler","command","rootDir","root","platforms","platform","reactNativePath","setupEnvironment","entryFile","entry","CLIError","errorHandler","error","stats","message","hasErrors","compilation","errors","forEach","console","process","exit","json","undefined","statsOptions","normalizeStatsOptions","compiler","options","statsJson","toJson","writeStats","filepath","context","String","webpack","Promise","resolve","watch","hooks","watchClose","tap","watchOptions","run","close","closeErr"],"sources":["../../../src/commands/webpack/bundle.ts"],"sourcesContent":["import webpack, { type Configuration } from 'webpack';\nimport { CLIError } from '../common/cliError.js';\nimport { makeCompilerConfig } from '../common/config/makeCompilerConfig.js';\nimport { normalizeStatsOptions, writeStats } from '../common/index.js';\nimport { setupEnvironment } from '../common/setupEnvironment.js';\nimport type { BundleArguments, CliConfig } from '../types.js';\n/**\n * Bundle command that builds and saves the bundle\n * alongside any other assets to filesystem using Webpack.\n *\n * @param _ Original, non-parsed arguments that were provided when running this command.\n * @param cliConfig Configuration object containing platform and project settings.\n * @param args Parsed command line arguments.\n */\nexport async function bundle(\n  _: string[],\n  cliConfig: CliConfig,\n  args: BundleArguments\n) {\n  const [config] = await makeCompilerConfig<Configuration>({\n    args: args,\n    bundler: 'webpack',\n    command: 'bundle',\n    rootDir: cliConfig.root,\n    platforms: [args.platform],\n    reactNativePath: cliConfig.reactNativePath,\n  });\n\n  // expose selected args as environment variables\n  setupEnvironment(args);\n\n  if (!args.entryFile && !config.entry) {\n    throw new CLIError(\"Option '--entry-file <path>' argument is missing\");\n  }\n\n  const errorHandler = async (error: Error | null, stats?: webpack.Stats) => {\n    if (error) {\n      throw new CLIError(error.message);\n    }\n\n    if (stats?.hasErrors()) {\n      stats.compilation?.errors?.forEach((e) => {\n        console.error(e);\n      });\n      process.exit(2);\n    }\n\n    if (args.json && stats !== undefined) {\n      const statsOptions = normalizeStatsOptions(\n        compiler.options.stats,\n        args.stats\n      );\n\n      const statsJson = stats.toJson(statsOptions);\n      try {\n        await writeStats(statsJson, {\n          filepath: args.json,\n          rootDir: compiler.context,\n        });\n      } catch (e) {\n        throw new CLIError(String(e));\n      }\n    }\n  };\n\n  const compiler = webpack(config);\n\n  return new Promise<void>((resolve) => {\n    if (args.watch) {\n      compiler.hooks.watchClose.tap('bundle', resolve);\n      compiler.watch(config.watchOptions ?? {}, errorHandler);\n    } else {\n      compiler.run((error, stats) => {\n        // make cache work: https://webpack.js.org/api/node/#run\n        compiler.close(async (closeErr) => {\n          if (closeErr) console.error(closeErr);\n          await errorHandler(error, stats);\n          resolve();\n        });\n      });\n    }\n  });\n}\n"],"mappings":";;;;;;AAAA,IAAAA,QAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,SAAA,GAAAD,OAAA;AACA,IAAAE,mBAAA,GAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AACA,IAAAI,iBAAA,GAAAJ,OAAA;AAAiE,SAAAD,uBAAAM,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAEjE;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,eAAeG,MAAMA,CAC1BC,CAAW,EACXC,SAAoB,EACpBC,IAAqB,EACrB;EACA,MAAM,CAACC,MAAM,CAAC,GAAG,MAAM,IAAAC,sCAAkB,EAAgB;IACvDF,IAAI,EAAEA,IAAI;IACVG,OAAO,EAAE,SAAS;IAClBC,OAAO,EAAE,QAAQ;IACjBC,OAAO,EAAEN,SAAS,CAACO,IAAI;IACvBC,SAAS,EAAE,CAACP,IAAI,CAACQ,QAAQ,CAAC;IAC1BC,eAAe,EAAEV,SAAS,CAACU;EAC7B,CAAC,CAAC;;EAEF;EACA,IAAAC,kCAAgB,EAACV,IAAI,CAAC;EAEtB,IAAI,CAACA,IAAI,CAACW,SAAS,IAAI,CAACV,MAAM,CAACW,KAAK,EAAE;IACpC,MAAM,IAAIC,kBAAQ,CAAC,kDAAkD,CAAC;EACxE;EAEA,MAAMC,YAAY,GAAG,MAAAA,CAAOC,KAAmB,EAAEC,KAAqB,KAAK;IACzE,IAAID,KAAK,EAAE;MACT,MAAM,IAAIF,kBAAQ,CAACE,KAAK,CAACE,OAAO,CAAC;IACnC;IAEA,IAAID,KAAK,EAAEE,SAAS,CAAC,CAAC,EAAE;MACtBF,KAAK,CAACG,WAAW,EAAEC,MAAM,EAAEC,OAAO,CAAE3B,CAAC,IAAK;QACxC4B,OAAO,CAACP,KAAK,CAACrB,CAAC,CAAC;MAClB,CAAC,CAAC;MACF6B,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC;IACjB;IAEA,IAAIxB,IAAI,CAACyB,IAAI,IAAIT,KAAK,KAAKU,SAAS,EAAE;MACpC,MAAMC,YAAY,GAAG,IAAAC,4BAAqB,EACxCC,QAAQ,CAACC,OAAO,CAACd,KAAK,EACtBhB,IAAI,CAACgB,KACP,CAAC;MAED,MAAMe,SAAS,GAAGf,KAAK,CAACgB,MAAM,CAACL,YAAY,CAAC;MAC5C,IAAI;QACF,MAAM,IAAAM,iBAAU,EAACF,SAAS,EAAE;UAC1BG,QAAQ,EAAElC,IAAI,CAACyB,IAAI;UACnBpB,OAAO,EAAEwB,QAAQ,CAACM;QACpB,CAAC,CAAC;MACJ,CAAC,CAAC,OAAOzC,CAAC,EAAE;QACV,MAAM,IAAImB,kBAAQ,CAACuB,MAAM,CAAC1C,CAAC,CAAC,CAAC;MAC/B;IACF;EACF,CAAC;EAED,MAAMmC,QAAQ,GAAG,IAAAQ,gBAAO,EAACpC,MAAM,CAAC;EAEhC,OAAO,IAAIqC,OAAO,CAAQC,OAAO,IAAK;IACpC,IAAIvC,IAAI,CAACwC,KAAK,EAAE;MACdX,QAAQ,CAACY,KAAK,CAACC,UAAU,CAACC,GAAG,CAAC,QAAQ,EAAEJ,OAAO,CAAC;MAChDV,QAAQ,CAACW,KAAK,CAACvC,MAAM,CAAC2C,YAAY,IAAI,CAAC,CAAC,EAAE9B,YAAY,CAAC;IACzD,CAAC,MAAM;MACLe,QAAQ,CAACgB,GAAG,CAAC,CAAC9B,KAAK,EAAEC,KAAK,KAAK;QAC7B;QACAa,QAAQ,CAACiB,KAAK,CAAC,MAAOC,QAAQ,IAAK;UACjC,IAAIA,QAAQ,EAAEzB,OAAO,CAACP,KAAK,CAACgC,QAAQ,CAAC;UACrC,MAAMjC,YAAY,CAACC,KAAK,EAAEC,KAAK,CAAC;UAChCuB,OAAO,CAAC,CAAC;QACX,CAAC,CAAC;MACJ,CAAC,CAAC;IACJ;EACF,CAAC,CAAC;AACJ","ignoreList":[]}