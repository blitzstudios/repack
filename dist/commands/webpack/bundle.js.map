{"version":3,"file":"bundle.js","names":["_webpack","_interopRequireDefault","require","_env","_common","e","__esModule","default","bundle","_","cliConfig","args","webpackConfigPath","getWebpackConfigFilePath","root","config","webpackConfig","cliOptions","platforms","Object","keys","bundlerConfigPath","reactNativePath","command","arguments","entryFile","Error","verbose","process","env","VERBOSE_ENV_KEY","envOptions","getEnvOptions","loadConfig","errorHandler","error","stats","console","exit","hasErrors","compilation","errors","forEach","json","undefined","statsOptions","normalizeStatsOptions","compiler","options","statsJson","toJson","writeStats","filepath","rootDir","context","String","webpack","Promise","resolve","watch","hooks","watchClose","tap","watchOptions","run","close","closeErr"],"sources":["../../../src/commands/webpack/bundle.ts"],"sourcesContent":["import type { Config } from '@react-native-community/cli-types';\nimport webpack, { type Configuration } from 'webpack';\nimport { VERBOSE_ENV_KEY } from '../../env';\nimport {\n  getEnvOptions,\n  getWebpackConfigFilePath,\n  loadConfig,\n  normalizeStatsOptions,\n  writeStats,\n} from '../common';\nimport type { BundleArguments, BundleCliOptions } from '../types';\n\n/**\n * Bundle command for React Native Community CLI.\n * It runs Webpack, builds bundle and saves it alongside any other assets and Source Map\n * to filesystem.\n *\n * @param _ Original, non-parsed arguments that were provided when running this command.\n * @param config React Native Community CLI configuration object.\n * @param args Parsed command line arguments.\n *\n * @internal\n * @category CLI command\n */\nexport async function bundle(\n  _: string[],\n  cliConfig: Config,\n  args: BundleArguments\n) {\n  const webpackConfigPath = getWebpackConfigFilePath(\n    cliConfig.root,\n    args.config ?? args.webpackConfig\n  );\n\n  const cliOptions: BundleCliOptions = {\n    config: {\n      root: cliConfig.root,\n      platforms: Object.keys(cliConfig.platforms),\n      bundlerConfigPath: webpackConfigPath,\n      reactNativePath: cliConfig.reactNativePath,\n    },\n    command: 'bundle',\n    arguments: { bundle: args },\n  };\n\n  if (!args.entryFile) {\n    throw new Error(\"Option '--entry-file <path>' argument is missing\");\n  }\n\n  if (args.verbose) {\n    process.env[VERBOSE_ENV_KEY] = '1';\n  }\n\n  const envOptions = getEnvOptions(cliOptions);\n  const webpackConfig = await loadConfig<Configuration>(\n    webpackConfigPath,\n    envOptions\n  );\n\n  const errorHandler = async (error: Error | null, stats?: webpack.Stats) => {\n    if (error) {\n      console.error(error);\n      process.exit(2);\n    }\n\n    if (stats?.hasErrors()) {\n      stats.compilation?.errors?.forEach((e) => {\n        console.error(e);\n      });\n      process.exit(2);\n    }\n\n    if (args.json && stats !== undefined) {\n      const statsOptions = normalizeStatsOptions(\n        compiler.options.stats,\n        args.stats\n      );\n\n      const statsJson = stats.toJson(statsOptions);\n      try {\n        await writeStats(statsJson, {\n          filepath: args.json,\n          rootDir: compiler.context,\n        });\n      } catch (e) {\n        console.error(String(e));\n        process.exit(2);\n      }\n    }\n  };\n\n  const compiler = webpack(webpackConfig);\n\n  return new Promise<void>((resolve) => {\n    if (args.watch) {\n      compiler.hooks.watchClose.tap('bundle', resolve);\n      compiler.watch(webpackConfig.watchOptions ?? {}, errorHandler);\n    } else {\n      compiler.run((error, stats) => {\n        // make cache work: https://webpack.js.org/api/node/#run\n        compiler.close(async (closeErr) => {\n          if (closeErr) console.error(closeErr);\n          await errorHandler(error, stats);\n          resolve();\n        });\n      });\n    }\n  });\n}\n"],"mappings":"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","ignoreList":[]}